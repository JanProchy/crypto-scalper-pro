<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scalper 2 Strategy - SOL/USDT Trading Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap');
        
        :root {
            --crypto-primary: #00d4ff;
            --crypto-secondary: #0099cc;
            --crypto-accent: #00ffaa;
            --crypto-purple: #8b5cf6;
            --crypto-pink: #ec4899;
            --crypto-dark: #0a0e1a;
            --crypto-darker: #050810;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --neon-glow: 0 0 20px rgba(0, 212, 255, 0.5);
            --neon-glow-strong: 0 0 30px rgba(0, 212, 255, 0.8);
        }
        
        * {
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f3a 50%, #0f1419 100%);
            background-attachment: fixed;
            color: #e2e8f0;
            overflow-x: hidden;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(10, 14, 26, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, var(--crypto-primary), var(--crypto-secondary));
            border-radius: 4px;
            box-shadow: var(--neon-glow);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, var(--crypto-secondary), var(--crypto-primary));
            box-shadow: var(--neon-glow-strong);
        }
        
        /* Glassmorphism Effects */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.5), transparent);
        }
        
        /* Crypto Gradients */
        .crypto-gradient {
            background: linear-gradient(135deg, var(--crypto-primary) 0%, var(--crypto-secondary) 50%, var(--crypto-purple) 100%);
        }
        
        .crypto-gradient-text {
            background: linear-gradient(135deg, var(--crypto-primary), var(--crypto-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        
        .crypto-glow {
            box-shadow: var(--neon-glow);
            border: 1px solid rgba(0, 212, 255, 0.3);
        }
        
        .crypto-glow-strong {
            box-shadow: var(--neon-glow-strong);
            border: 1px solid rgba(0, 212, 255, 0.5);
        }
        
        /* Animated Buttons */
        .crypto-btn {
            background: linear-gradient(135deg, var(--crypto-primary), var(--crypto-secondary));
            border: none;
            border-radius: 12px;
            color: #1e293b;
            font-weight: 600;
            padding: 12px 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }
        
        .crypto-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .crypto-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.5);
        }
        
        .crypto-btn:hover::before {
            left: 100%;
        }
        
        .crypto-btn:active {
            transform: translateY(0);
        }
        
        /* Status Indicators with Glow */
        .status-indicator { 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            display: inline-block; 
            margin-right: 8px;
            position: relative;
        }
        
        .status-indicator::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 50%;
            opacity: 0.6;
            animation: pulse 2s infinite;
        }
        
        .status-valid { 
            background-color: var(--crypto-accent);
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }
        
        .status-valid::after {
            background-color: var(--crypto-accent);
        }
        
        .status-invalid { 
            background-color: #ff4757;
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
        }
        
        .status-invalid::after {
            background-color: #ff4757;
        }
        
        .status-warning { 
            background-color: #ffa502;
            box-shadow: 0 0 10px rgba(255, 165, 2, 0.5);
        }
        
        .status-warning::after {
            background-color: #ffa502;
        }
        
        /* Animations */
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.3;
            }
            100% {
                transform: scale(1);
                opacity: 0.6;
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(0, 212, 255, 0.6);
            }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        .glowing {
            animation: glow 2s ease-in-out infinite;
        }
        
        /* Header Styles */
        .crypto-header {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .crypto-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(0,212,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }
        
        .crypto-title {
            font-family: 'Orbitron', monospace;
            font-weight: 800;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #00d4ff 0%, #00ffaa 50%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
            position: relative;
        }
        
        /* Card Hover Effects */
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(0, 212, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        /* Signal Cards */
        .signal-card {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(0, 153, 204, 0.1) 100%);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .signal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--crypto-primary), var(--crypto-accent), var(--crypto-primary));
            animation: shimmer 2s linear infinite;
        }
        
        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        /* Input Styles */
        .crypto-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #e2e8f0;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }
        
        .crypto-input:focus {
            outline: none;
            border-color: var(--crypto-primary);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }
        
        /* Toggle Switches */
        .crypto-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .crypto-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .crypto-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            transition: 0.4s;
            border-radius: 24px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }
        
        .crypto-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background: linear-gradient(135deg, var(--crypto-primary), var(--crypto-secondary));
            transition: 0.4s;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        input:checked + .crypto-slider {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--crypto-primary);
        }
        
        input:checked + .crypto-slider:before {
            transform: translateX(26px);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.8);
        }
        
        /* Data Strip */
        .data-strip {
            background: linear-gradient(90deg, rgba(0, 212, 255, 0.1) 0%, rgba(139, 92, 246, 0.1) 50%, rgba(0, 212, 255, 0.1) 100%);
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            position: relative;
        }
        
        .data-strip::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--crypto-primary), transparent);
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .crypto-title {
                font-size: 1.8rem;
            }
            
            .glass-card {
                margin: 10px;
                border-radius: 15px;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Data Sources Info Strip -->
    <div class="data-strip text-slate-300 py-3">
        <div class="container mx-auto px-6">
            <div class="flex items-center justify-center text-sm font-medium">
                <span class="mr-4 crypto-gradient-text">⚡ Data Sources:</span>
                <span class="mr-4">Primary: Bybit API</span>
                <span class="mr-4 text-cyan-400">•</span>
                <span class="mr-4">Backup: CoinGecko API</span>
                <span class="mr-4 text-cyan-400">•</span>
                <span>TA: TradingView Indicators</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div class="crypto-header text-slate-200 py-8">
        <div class="container mx-auto px-6 relative z-10">
            <div class="flex items-center justify-between">
                <div class="floating">
                    <h1 class="crypto-title mb-3">🚀 CryptoScalper Pro</h1>
                    <p class="text-lg text-cyan-200 font-medium">
                        Advanced Multi-Signal Trading Platform
                        <span class="crypto-gradient-text ml-2">• SOL/USDT Active</span>
                    </p>
                    <div class="flex items-center gap-4 mt-2 text-sm">
                        <div class="flex items-center">
                            <span class="status-indicator status-valid"></span>
                            <span class="text-green-400">Live Data Feed</span>
                        </div>
                        <div class="flex items-center">
                            <span class="status-indicator status-valid"></span>
                            <span class="text-green-400">AI Analysis Active</span>
                        </div>
                        <div class="flex items-center">
                            <span class="status-indicator status-valid"></span>
                            <span class="text-green-400">Multi-Signal Ready</span>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col gap-3">
                    <button onclick="refreshData()" class="crypto-btn glowing">
                        🔄 Refresh Data
                    </button>
                    <div class="text-right text-sm">
                        <div class="crypto-gradient-text font-semibold">System Status</div>
                        <div class="text-green-400">🟢 All Systems Online</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-6 py-8">
        <!-- Trading Configuration Engine -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Configuration Panel -->
            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-lg font-semibold crypto-gradient-text mb-4">⚙️ Trading Configuration Engine</h3>
                
                <div class="space-y-4">
                    <!-- Trading Pair -->
                    <div>
                        <label class="block text-sm font-medium text-cyan-300 mb-2">Trading Pár</label>
                        <select id="coin-selector" onchange="changeCoin()" class="w-full crypto-input text-sm rounded-lg p-2.5">
                            <option value="BTCUSDT">BTC/USDT</option>
                            <option value="ETHUSDT">ETH/USDT</option>
                            <option value="ADAUSDT">ADA/USDT</option>
                            <option value="XRPUSDT">XRP/USDT</option>
                            <option value="SOLUSDT" selected>SOL/USDT</option>
                            <option value="AVAXUSDT">AVAX/USDT</option>
                            <option value="DOGEUSDT">DOGE/USDT</option>
                            <option value="LINKUSDT">LINK/USDT</option>
                            <option value="DOTUSDT">DOT/USDT</option>
                            <option value="HYPEUSDT">HYPE/USDT</option>
                            <option value="APTUSDT">APT/USDT</option>
                            <option value="TIAUSDT">TIA/USDT</option>
                            <option value="OPUSDT">OP/USDT</option>
                            <option value="SUIUSDT">SUI/USDT</option>
                            <option value="ARKMUSDT">ARKM/USDT</option>
                            <option value="WLDUSDT">WLD/USDT</option>
                        </select>
                    </div>

                    <!-- Timeframe -->
                    <div>
                        <label class="block text-sm font-medium text-cyan-300 mb-2">Časový Rámec</label>
                        <select id="timeframe-selector" onchange="updateTimeframe()" class="w-full crypto-input text-sm rounded-lg p-2.5">
                            <option value="1m">1 minuta</option>
                            <option value="3m" selected>3 minuty</option>
                            <option value="5m">5 minut</option>
                            <option value="15m">15 minut</option>
                            <option value="30m">30 minut</option>
                            <option value="1h">1 hodina</option>
                            <option value="4h">4 hodiny</option>
                            <option value="12h">12 hodin</option>
                            <option value="1D">1 den</option>
                        </select>
                    </div>

                    <!-- Refresh Cycle -->
                    <div>
                        <label class="block text-sm font-medium text-cyan-300 mb-2">Obnovovací Cyklus</label>
                        <select id="refresh-cycle" onchange="updateRefreshCycle()" class="w-full crypto-input text-sm rounded-lg p-2.5">
                            <option value="1m">1 minuta</option>
                            <option value="3m">3 minuty</option>
                            <option value="5m">5 minut</option>
                            <option value="15m">15 minut</option>
                            <option value="30m">30 minut</option>
                            <option value="1h" selected>1 hodina</option>
                            <option value="4h">4 hodiny</option>
                            <option value="12h">12 hodin</option>
                            <option value="1D">1 den</option>
                        </select>
                    </div>

                    <!-- Risk Level -->
                    <div>
                        <label class="block text-sm font-medium text-cyan-300 mb-2">Risk Level</label>
                        <div class="flex gap-2">
                            <button onclick="setRiskLevel('low')" id="risk-low" class="flex-1 px-3 py-2 text-sm rounded-lg border border-green-400 text-green-400 hover:bg-green-400 hover:bg-opacity-20 transition-colors">
                                🟢 Nízké
                            </button>
                            <button onclick="setRiskLevel('medium')" id="risk-medium" class="flex-1 px-3 py-2 text-sm rounded-lg border border-yellow-400 bg-yellow-400 bg-opacity-20 text-yellow-400 hover:bg-opacity-30 transition-colors">
                                🟡 Střední
                            </button>
                            <button onclick="setRiskLevel('high')" id="risk-high" class="flex-1 px-3 py-2 text-sm rounded-lg border border-red-400 text-red-400 hover:bg-red-400 hover:bg-opacity-20 transition-colors">
                                🔴 Vysoké
                            </button>
                        </div>
                    </div>

                    <!-- Sound Alerts -->
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" id="sound-alerts" checked onchange="toggleSoundAlerts()" class="rounded border-cyan-400 text-cyan-400 bg-transparent focus:border-cyan-300 focus:ring focus:ring-cyan-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-cyan-300">🔊 Zvukové Oznámení</span>
                        </label>
                        <p class="text-xs text-gray-400 mt-1">Upozornění při změně signálu</p>
                    </div>

                    <!-- Entry Price Type -->
                    <div>
                        <label class="block text-sm font-medium text-cyan-300 mb-2">Entry Price (podle TA)</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setEntryType('limit')" id="entry-limit" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 bg-cyan-400 bg-opacity-20 text-cyan-400 transition-colors">
                                📋 Limit
                            </button>
                            <button onclick="setEntryType('market')" id="entry-market" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 border-opacity-30 hover:bg-cyan-400 hover:bg-opacity-20 transition-colors text-slate-300">
                                ⚡ Market
                            </button>
                            <button onclick="setEntryType('conditional')" id="entry-conditional" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 border-opacity-30 hover:bg-cyan-400 hover:bg-opacity-20 transition-colors text-slate-300">
                                🎯 Conditional
                            </button>
                        </div>
                    </div>

                    <!-- Trading Signal Sound Alert -->
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" id="signal-sound-alerts" checked onchange="toggleSignalSoundAlerts()" class="rounded border-cyan-400 text-cyan-400 bg-transparent focus:border-cyan-300 focus:ring focus:ring-cyan-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-cyan-300">🔔 Zvukové Oznámení při Změně Trading Signálu</span>
                        </label>
                        <p class="text-xs text-slate-400 mt-1">Upozornění při změně směru nebo síly signálu</p>
                    </div>

                    <!-- Current Status -->
                    <div class="pt-4 border-t border-cyan-400 border-opacity-30">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-slate-400">Entry Typ:</span>
                                <div id="entry-type" class="font-semibold text-cyan-400">Limit Order</div>
                            </div>
                            <div>
                                <span class="text-slate-400">Pozice Směr:</span>
                                <div id="position-direction" class="font-semibold text-green-400">Auto Trend</div>
                            </div>
                            <div>
                                <span class="text-slate-400">Aktuální Trend:</span>
                                <div id="current-trend" class="font-semibold">
                                    <span class="text-green-400">📈 Bullish</span>
                                    <span class="text-xs text-slate-500">(Síla: 78%)</span>
                                </div>
                            </div>
                            <div>
                                <span class="text-slate-400">Status:</span>
                                <div class="flex items-center">
                                    <span class="status-indicator status-valid"></span>
                                    <span class="text-green-400 text-sm font-medium">Připraven</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Volume Spike Monitor -->
            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-lg font-semibold crypto-gradient-text mb-4">📊 Volume Spike Monitor</h3>
                
                <div class="space-y-4">
                    <!-- Monitor Toggle -->
                    <div class="flex items-center justify-between p-3 bg-cyan-400 bg-opacity-10 rounded-lg border border-cyan-400 border-opacity-30">
                        <div>
                            <span class="font-medium text-cyan-300">Monitor Active</span>
                            <p class="text-xs text-cyan-400">Sledování volume spiků napříč všemi coiny</p>
                        </div>
                        <label class="crypto-toggle">
                            <input type="checkbox" id="volume-monitor" checked onchange="toggleVolumeMonitor()">
                            <span class="crypto-slider"></span>
                        </label>
                    </div>

                    <!-- Volume Threshold -->
                    <div>
                        <label class="block text-sm font-medium text-cyan-300 mb-2">Volume Spike Threshold</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="setVolumeThreshold(150)" id="vol-150" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 border-opacity-30 hover:bg-cyan-400 hover:bg-opacity-20 transition-colors text-slate-300">150%</button>
                            <button onclick="setVolumeThreshold(200)" id="vol-200" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 bg-cyan-400 bg-opacity-20 text-cyan-400 transition-colors">200%</button>
                            <button onclick="setVolumeThreshold(300)" id="vol-300" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 border-opacity-30 hover:bg-cyan-400 hover:bg-opacity-20 transition-colors text-slate-300">300%</button>
                            <button onclick="setVolumeThreshold(500)" id="vol-500" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 border-opacity-30 hover:bg-cyan-400 hover:bg-opacity-20 transition-colors text-slate-300">500%</button>
                        </div>
                    </div>

                    <!-- Monitor Timeframe -->
                    <div>
                        <label class="block text-sm font-medium text-cyan-300 mb-2">Monitor Timeframe</label>
                        <select id="monitor-timeframe" onchange="updateMonitorTimeframe()" class="w-full crypto-input text-sm rounded-lg p-2.5">
                            <option value="1m">1 minuta</option>
                            <option value="3m">3 minuty</option>
                            <option value="5m" selected>5 minut</option>
                            <option value="15m">15 minut</option>
                            <option value="1h">1 hodina</option>
                            <option value="4h">4 hodiny</option>
                            <option value="12h">12 hodin</option>
                            <option value="1D">1 den</option>
                        </select>
                    </div>

                    <!-- Alert Sound -->
                    <div>
                        <label class="block text-sm font-medium text-cyan-300 mb-2">Alert Sound</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="setAlertSound('beep')" id="sound-beep" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 bg-cyan-400 bg-opacity-20 text-cyan-400 transition-colors">🔔 Beep</button>
                            <button onclick="setAlertSound('chime')" id="sound-chime" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 border-opacity-30 hover:bg-cyan-400 hover:bg-opacity-20 transition-colors text-slate-300">🎵 Chime</button>
                            <button onclick="setAlertSound('alert')" id="sound-alert" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 border-opacity-30 hover:bg-cyan-400 hover:bg-opacity-20 transition-colors text-slate-300">⚠️ Alert</button>
                            <button onclick="setAlertSound('notification')" id="sound-notification" class="px-3 py-2 text-sm rounded-lg border border-cyan-400 border-opacity-30 hover:bg-cyan-400 hover:bg-opacity-20 transition-colors text-slate-300">📢 Notification</button>
                        </div>
                    </div>

                    <!-- Volume Alerts -->
                    <div id="volume-alerts" class="space-y-2 max-h-40 overflow-y-auto">
                        <div class="text-sm text-gray-400 text-center py-4">
                            Žádné volume spiky zatím...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Overview -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="glass-card p-6 crypto-glow-strong">
                <h3 class="text-lg font-semibold mb-4 crypto-gradient-text">📈 Aktuální Tržní Data</h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span id="price-label" class="text-gray-400">SOL/USDT Cena:</span>
                        <span id="coin-price" class="font-semibold text-cyan-400">Loading...</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">24h Změna:</span>
                        <span id="coin-change" class="font-semibold">Loading...</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Objem 24h:</span>
                        <span id="coin-volume" class="font-semibold text-slate-300">Loading...</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">BTC Dominance:</span>
                        <span id="btc-dominance" class="font-semibold text-slate-300">Loading...</span>
                    </div>
                </div>
            </div>

            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-lg font-semibold mb-4 crypto-gradient-text">⚡ Smart Money Indikátory</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Funding Rate:</span>
                        <span id="funding-rate" class="font-semibold">Loading...</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Open Interest:</span>
                        <span id="open-interest" class="font-semibold">Loading...</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Long/Short Ratio:</span>
                        <span id="long-short-ratio" class="font-semibold">Loading...</span>
                    </div>
                </div>
            </div>

            <div class="glass-card p-6 crypto-glow-strong floating">
                <h3 class="text-lg font-semibold mb-4 crypto-gradient-text">🎯 Aktuální Setup</h3>
                <div class="text-center">
                    <div id="trade-direction" class="text-2xl font-bold mb-2 crypto-gradient-text">LONG</div>
                    <div class="text-sm text-gray-400 mb-3">Doporučený směr</div>
                    <div class="bg-green-400 bg-opacity-20 text-green-400 px-3 py-1 rounded-full text-sm font-medium border border-green-400 border-opacity-30">
                        <span class="status-indicator status-valid"></span>
                        Setup Validní
                    </div>
                </div>
            </div>
        </div>

        <!-- Multi-Signal Management -->
        <div id="signals-container" class="mb-8">
            <!-- Active signals will be populated here -->
        </div>

        <!-- Multi-Signal Controls -->
        <div class="glass-card p-6 crypto-glow-strong mb-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-semibold crypto-gradient-text mb-2">🎯 Multi-Signal Management</h3>
                    <p class="text-gray-400 text-sm">Spravujte až 5 aktivních signálů současně s nezávislým sledováním</p>
                </div>
                <div class="flex items-center gap-3">
                    <div class="text-right text-sm">
                        <div class="crypto-gradient-text font-semibold">Aktivní Signály</div>
                        <div id="active-signals-count" class="text-cyan-400">0 / 5</div>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-wrap gap-4 justify-center">
                <button onclick="addSignal()" class="crypto-btn glowing">
                    ➕ PŘIDAT SIGNÁL
                </button>
                <button onclick="clearAllSignals()" class="bg-red-600 hover:bg-red-700 text-slate-100 px-6 py-3 rounded-lg font-medium transition-all hover:transform hover:scale-105">
                    🗑️ VYMAZAT VŠE
                </button>
            </div>
        </div>

        <!-- Enhanced Technical Analysis -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Fibonacci Analysis -->
            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-lg font-semibold mb-4 crypto-gradient-text">📐 Fibonacci Levels</h3>
                <div class="space-y-3">
                    <div class="text-xs text-gray-400 mb-3">Založeno na 24h High/Low</div>
                    <div id="fib-levels" class="space-y-2">
                        <!-- Fibonacci levels will be populated here -->
                    </div>
                    <div class="pt-3 border-t border-cyan-400 border-opacity-30">
                        <div class="flex justify-between text-xs">
                            <span class="text-gray-400">Aktuální pozice:</span>
                            <span id="fib-position" class="font-semibold text-cyan-400">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Support/Resistance -->
            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-lg font-semibold mb-4 crypto-gradient-text">📊 S/R Levels</h3>
                <div class="space-y-3">
                    <div class="text-xs text-gray-400 mb-3">Auto-detekované úrovně</div>
                    <div id="sr-levels" class="space-y-2">
                        <!-- S/R levels will be populated here -->
                    </div>
                    <div class="pt-3 border-t border-cyan-400 border-opacity-30">
                        <div class="flex justify-between text-xs">
                            <span class="text-gray-400">Nejbližší:</span>
                            <span id="nearest-sr" class="font-semibold text-purple-400">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Technical Indicators -->
            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-lg font-semibold mb-4 crypto-gradient-text">⚡ Tech Indikátory</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-400">RSI (14):</span>
                        <span id="rsi-value" class="font-semibold">Loading...</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-400">MACD Signal:</span>
                        <span id="macd-signal" class="font-semibold">Loading...</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-400">Bollinger:</span>
                        <span id="bb-position" class="font-semibold">Loading...</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-400">Volume Trend:</span>
                        <span id="volume-trend" class="font-semibold">Loading...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trading Plan -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Entry Analysis -->
            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-xl font-semibold mb-6 crypto-gradient-text">🎯 Vstupní Analýza</h3>
                
                <div class="mb-6">
                    <h4 class="font-semibold text-slate-200 mb-3">Timeframe Analýza:</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center p-2 bg-cyan-400 bg-opacity-10 rounded border border-cyan-400 border-opacity-30">
                            <span class="text-sm text-slate-300">1H (HTF Trend):</span>
                            <span class="text-slate-200 font-medium">📈 Bullish</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-cyan-400 bg-opacity-10 rounded border border-cyan-400 border-opacity-30">
                            <span class="text-sm text-slate-300">15M (Mikrostruktura):</span>
                            <span class="text-slate-200 font-medium">🔄 Pullback</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-cyan-400 bg-opacity-10 rounded border border-cyan-400 border-opacity-30">
                            <span class="text-sm text-slate-300">3M (PA Potvrzení):</span>
                            <span class="text-slate-200 font-medium">✅ Reversal</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-cyan-400 bg-opacity-10 rounded border border-cyan-400 border-opacity-30">
                            <span class="text-sm text-slate-300">1M (Entry Přesnost):</span>
                            <span class="text-slate-200 font-medium">🎯 Ready</span>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="font-semibold text-slate-200 mb-3">Vstupní Zóna:</h4>
                    <div class="bg-blue-400 bg-opacity-10 p-4 rounded-lg border border-blue-400 border-opacity-30">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-slate-300">Order Block:</span>
                                <div id="ob-zone" class="font-semibold text-slate-200">Loading...</div>
                            </div>
                            <div>
                                <span class="text-slate-300">LVN Zóna:</span>
                                <div id="lvn-zone" class="font-semibold text-slate-200">Loading...</div>
                            </div>
                            <div>
                                <span class="text-slate-300">PoC Level:</span>
                                <div id="poc-level" class="font-semibold text-slate-200">Loading...</div>
                            </div>
                            <div>
                                <span class="text-slate-300">S/R Level:</span>
                                <div id="sr-level" class="font-semibold text-slate-200">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-3">Price Action Pattern:</h4>
                    <div class="bg-yellow-400 bg-opacity-10 p-4 rounded-lg border border-yellow-400 border-opacity-30">
                        <p class="text-sm text-slate-300">
                            <strong class="text-slate-200">Liquidity Sweep + Reversal:</strong> Cena provedla sweep pod $142.50 support, 
                            vybrala retail stop lossy a nyní se vrací zpět do Order Block zóny s vysokým objemem. 
                            EMA 21 poskytuje dynamický support na 15M timeframe.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Risk Management -->
            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-xl font-semibold mb-6 crypto-gradient-text">⚖️ Risk Management</h3>
                
                <div class="space-y-4">
                    <div class="p-4 bg-red-400 bg-opacity-10 rounded-lg border border-red-400 border-opacity-30">
                        <h4 class="font-semibold text-red-400 mb-2">Stop Loss</h4>
                        <div class="text-sm">
                            <div class="flex justify-between mb-1">
                                <span class="text-slate-300">Úroveň:</span>
                                <span class="font-semibold text-slate-200">$141.80</span>
                            </div>
                            <div class="flex justify-between mb-1">
                                <span class="text-slate-300">Vzdálenost:</span>
                                <span class="font-semibold text-slate-200">70 pips</span>
                            </div>
                            <div class="text-xs text-slate-400 mt-2">
                                Umístěno pod swept low, mimo retail likviditu
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-green-400 bg-opacity-10 rounded-lg border border-green-400 border-opacity-30">
                        <h4 class="font-semibold text-green-400 mb-2">Take Profit Levels</h4>
                        <div class="text-sm space-y-2">
                            <div class="flex justify-between">
                                <span class="text-slate-300">TP1 (50%):</span>
                                <span class="font-semibold text-slate-200">$144.80</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-300">TP2 (30%):</span>
                                <span class="font-semibold text-slate-200">$146.20</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-300">Runner (20%):</span>
                                <span class="font-semibold text-slate-200">Trailing Stop</span>
                            </div>
                            <div class="text-xs text-slate-400 mt-2">
                                RRR: 2.3:1 (TP1), 3.4:1 (TP2)
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-blue-400 bg-opacity-10 rounded-lg border border-blue-400 border-opacity-30">
                        <h4 class="font-semibold text-blue-400 mb-2">Trailing Stop</h4>
                        <div class="text-sm">
                            <div class="flex justify-between mb-1">
                                <span class="text-slate-300">Aktivace:</span>
                                <span class="font-semibold text-slate-200">Po TP1</span>
                            </div>
                            <div class="flex justify-between mb-1">
                                <span class="text-slate-300">Vzdálenost:</span>
                                <span class="font-semibold text-slate-200">0.5% ATR</span>
                            </div>
                            <div class="text-xs text-slate-400 mt-2">
                                Sleduje EMA 21 na 3M timeframe
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Validation Checklists -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Main Checklist -->
            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-xl font-semibold mb-6 crypto-gradient-text">✅ Hlavní Checklist (12/12)</h3>
                <div class="space-y-2">
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">HTF trend alignment (1H bullish)</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">EMA confluence (21, 50, 200)</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">Order Block identification</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">Volume Profile confirmation</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">Liquidity sweep completed</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">Smart Money divergence</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">Session timing (London/NY)</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">BTC correlation positive</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">Funding rate neutral/negative</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">OI increase confirmation</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">Price action reversal pattern</span>
                    </div>
                    <div class="flex items-center p-2 rounded">
                        <span class="status-indicator status-valid"></span>
                        <span class="text-sm text-slate-300">Risk/Reward ratio > 2:1</span>
                    </div>
                </div>
            </div>

            <!-- Entry Checklist -->
            <div class="glass-card p-6 crypto-glow">
                <h3 class="text-xl font-semibold mb-6 crypto-gradient-text">🎯 Vstupní Checklist (4/5)</h3>
                <div class="space-y-3">
                    <div class="p-3 bg-green-400 bg-opacity-10 rounded-lg border border-green-400 border-opacity-30">
                        <div class="flex items-center mb-2">
                            <span class="status-indicator status-valid"></span>
                            <span class="font-medium text-green-400">Reakce v zóně potvrzena</span>
                        </div>
                        <p class="text-sm text-slate-300">Cena reagovala na OB s vysokým objemem a bullish engulfing pattern na 3M</p>
                    </div>
                    
                    <div class="p-3 bg-green-400 bg-opacity-10 rounded-lg border border-green-400 border-opacity-30">
                        <div class="flex items-center mb-2">
                            <span class="status-indicator status-valid"></span>
                            <span class="font-medium text-green-400">Volume spike přítomen</span>
                        </div>
                        <p class="text-sm text-slate-300">Objem 3x nad průměrem posledních 20 svíček</p>
                    </div>
                    
                    <div class="p-3 bg-green-400 bg-opacity-10 rounded-lg border border-green-400 border-opacity-30">
                        <div class="flex items-center mb-2">
                            <span class="status-indicator status-valid"></span>
                            <span class="font-medium text-green-400">EMA support aktivní</span>
                        </div>
                        <p class="text-sm text-slate-300">EMA 21 poskytuje dynamický support, cena nad EMA 50</p>
                    </div>
                    
                    <div class="p-3 bg-green-400 bg-opacity-10 rounded-lg border border-green-400 border-opacity-30">
                        <div class="flex items-center mb-2">
                            <span class="status-indicator status-valid"></span>
                            <span class="font-medium text-green-400">Momentum shift detekován</span>
                        </div>
                        <p class="text-sm text-slate-300">RSI divergence + MACD cross na 15M timeframe</p>
                    </div>
                    
                    <div class="p-3 bg-yellow-400 bg-opacity-10 rounded-lg border border-yellow-400 border-opacity-30">
                        <div class="flex items-center mb-2">
                            <span class="status-indicator status-warning"></span>
                            <span class="font-medium text-yellow-400">Čekání na final trigger</span>
                        </div>
                        <p class="text-sm text-slate-300">Čekáme na break nad $143.20 s volume confirmation</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Correlation Analysis -->
        <div class="glass-card p-6 crypto-glow mb-8">
            <h3 class="text-xl font-semibold mb-6 crypto-gradient-text">📊 Korelační Analýza</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-400 mb-2">+0.73</div>
                    <div class="text-sm text-gray-400 mb-1">SOL/BTC Korelace</div>
                    <div class="text-xs text-green-400">Silně pozitivní</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-400 mb-2">58.2%</div>
                    <div class="text-sm text-gray-400 mb-1">BTC Dominance</div>
                    <div class="text-xs text-blue-400">Klesající trend</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-400 mb-2">+2.4%</div>
                    <div class="text-sm text-gray-400 mb-1">TOTAL 3 (24h)</div>
                    <div class="text-xs text-purple-400">Altcoin strength</div>
                </div>
            </div>
        </div>

        <!-- Signal Status -->
        <div id="signal-status" class="glass-card p-6 crypto-glow mb-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-lg font-semibold text-green-400 mb-2">🟢 Aktivní Signál</h3>
                    <div class="text-sm text-gray-400">
                        <div>Otevřeno: <span id="signal-open-time" class="font-medium text-slate-300"></span></div>
                        <div>Trvání: <span id="signal-duration" class="font-medium text-slate-300"></span></div>
                        <div>Status: <span id="signal-current-status" class="font-medium text-green-400">Monitorování</span></div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-green-400 mb-1" id="signal-pnl">+0.00%</div>
                    <div class="text-sm text-gray-400">P&L</div>
                </div>
            </div>

            <!-- Smart Position Management -->
            <div id="position-management" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Partial Close Controls -->
                <div class="bg-blue-400 bg-opacity-10 rounded-lg p-4 border border-blue-400 border-opacity-30">
                    <h4 class="font-semibold text-blue-400 mb-3">📊 Partial Close</h4>
                    <div class="grid grid-cols-3 gap-2 mb-3">
                        <button onclick="partialClose(25)" class="px-3 py-2 bg-blue-600 text-slate-100 text-sm rounded-lg hover:bg-blue-700 transition-colors">
                            25%
                        </button>
                        <button onclick="partialClose(50)" class="px-3 py-2 bg-blue-600 text-slate-100 text-sm rounded-lg hover:bg-blue-700 transition-colors">
                            50%
                        </button>
                        <button onclick="partialClose(75)" class="px-3 py-2 bg-blue-600 text-slate-100 text-sm rounded-lg hover:bg-blue-700 transition-colors">
                            75%
                        </button>
                    </div>
                    <div class="text-xs text-blue-400">
                        <div>Zbývající pozice: <span id="remaining-position" class="font-semibold">100%</span></div>
                        <div>Realizovaný P&L: <span id="realized-pnl" class="font-semibold">$0.00</span></div>
                    </div>
                </div>

                <!-- Trailing Stop Controls -->
                <div class="bg-purple-400 bg-opacity-10 rounded-lg p-4 border border-purple-400 border-opacity-30">
                    <h4 class="font-semibold text-purple-400 mb-3">🎯 Trailing Stop</h4>
                    <div class="space-y-2 mb-3">
                        <div class="flex items-center justify-between">
                            <label class="text-sm text-purple-400">Status:</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="trailing-stop-toggle" onchange="toggleTrailingStop()" class="sr-only peer">
                                <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="setTrailingDistance(0.5)" id="trail-0.5" class="px-2 py-1 text-xs rounded border border-purple-400 border-opacity-30 hover:bg-purple-400 hover:bg-opacity-20 transition-colors text-slate-300">0.5%</button>
                            <button onclick="setTrailingDistance(1.0)" id="trail-1.0" class="px-2 py-1 text-xs rounded border border-purple-400 bg-purple-400 bg-opacity-20 text-purple-400 transition-colors">1.0%</button>
                            <button onclick="setTrailingDistance(1.5)" id="trail-1.5" class="px-2 py-1 text-xs rounded border border-purple-400 border-opacity-30 hover:bg-purple-400 hover:bg-opacity-20 transition-colors text-slate-300">1.5%</button>
                            <button onclick="setTrailingDistance(2.0)" id="trail-2.0" class="px-2 py-1 text-xs rounded border border-purple-400 border-opacity-30 hover:bg-purple-400 hover:bg-opacity-20 transition-colors text-slate-300">2.0%</button>
                        </div>
                    </div>
                    <div class="text-xs text-purple-400">
                        <div>Aktuální SL: <span id="current-sl" class="font-semibold">$0.00</span></div>
                        <div>Max Profit: <span id="max-profit" class="font-semibold">+0.00%</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action History -->
        <div id="action-history" class="glass-card p-6 crypto-glow mb-8 hidden">
            <h3 class="text-lg font-semibold crypto-gradient-text mb-4">📋 Historie Akcí</h3>
            <div id="history-list" class="space-y-2 max-h-60 overflow-y-auto">
                <div class="text-sm text-gray-400 text-center py-4">
                    Žádné akce zatím...
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-4 justify-center mb-8">
            <button id="open-signal-btn" onclick="openSignal()" class="crypto-btn glowing">
                🎯 OPEN SIGNAL
            </button>
            <button id="close-signal-btn" onclick="closeSignal()" class="bg-red-600 hover:bg-red-700 text-slate-100 px-6 py-3 rounded-lg font-medium transition-all hover:transform hover:scale-105 hidden">
                🔴 CLOSE SIGNAL
            </button>
            <button onclick="exportPlan()" class="bg-purple-600 hover:bg-purple-700 text-slate-100 px-6 py-3 rounded-lg font-medium transition-all hover:transform hover:scale-105">
                📋 Export Plan
            </button>
        </div>

        <!-- Historical Signal Data -->
        <div class="glass-card p-6 crypto-glow">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-semibold crypto-gradient-text mb-2">📊 Historické Data Aktivních Signálů</h3>
                    <p class="text-slate-400 text-sm">Kompletní přehled všech uzavřených signálů s detailní analýzou výkonnosti</p>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="clearSignalHistory()" class="bg-red-600 hover:bg-red-700 text-slate-100 px-4 py-2 rounded-lg text-sm font-medium transition-all">
                        🗑️ Vymazat Historii
                    </button>
                    <button onclick="exportSignalHistory()" class="bg-blue-600 hover:bg-blue-700 text-slate-100 px-4 py-2 rounded-lg text-sm font-medium transition-all">
                        📥 Export CSV
                    </button>
                </div>
            </div>

            <!-- Performance Summary -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-slate-800 bg-opacity-50 rounded-lg p-4 border border-slate-600">
                    <div class="text-center">
                        <div id="total-signals" class="text-2xl font-bold text-cyan-400 mb-1">0</div>
                        <div class="text-sm text-slate-400">Celkem Signálů</div>
                    </div>
                </div>
                <div class="bg-slate-800 bg-opacity-50 rounded-lg p-4 border border-slate-600">
                    <div class="text-center">
                        <div id="win-rate" class="text-2xl font-bold text-green-400 mb-1">0%</div>
                        <div class="text-sm text-slate-400">Win Rate</div>
                    </div>
                </div>
                <div class="bg-slate-800 bg-opacity-50 rounded-lg p-4 border border-slate-600">
                    <div class="text-center">
                        <div id="total-pnl" class="text-2xl font-bold text-slate-300 mb-1">+0.00%</div>
                        <div class="text-sm text-slate-400">Celkový P&L</div>
                    </div>
                </div>
                <div class="bg-slate-800 bg-opacity-50 rounded-lg p-4 border border-slate-600">
                    <div class="text-center">
                        <div id="avg-pnl" class="text-2xl font-bold text-slate-300 mb-1">+0.00%</div>
                        <div class="text-sm text-slate-400">Průměrný P&L</div>
                    </div>
                </div>
            </div>

            <!-- Filter Controls -->
            <div class="flex flex-wrap gap-4 mb-6 p-4 bg-slate-800 bg-opacity-30 rounded-lg border border-slate-600">
                <div class="flex items-center gap-2">
                    <label class="text-sm text-slate-300">Filtr podle páru:</label>
                    <select id="history-pair-filter" onchange="filterSignalHistory()" class="crypto-input text-sm rounded-lg p-2">
                        <option value="all">Všechny páry</option>
                        <option value="BTCUSDT">BTC/USDT</option>
                        <option value="ETHUSDT">ETH/USDT</option>
                        <option value="SOLUSDT">SOL/USDT</option>
                        <option value="ADAUSDT">ADA/USDT</option>
                        <option value="XRPUSDT">XRP/USDT</option>
                    </select>
                </div>
                <div class="flex items-center gap-2">
                    <label class="text-sm text-slate-300">Směr:</label>
                    <select id="history-direction-filter" onchange="filterSignalHistory()" class="crypto-input text-sm rounded-lg p-2">
                        <option value="all">Všechny směry</option>
                        <option value="LONG">LONG pouze</option>
                        <option value="SHORT">SHORT pouze</option>
                    </select>
                </div>
                <div class="flex items-center gap-2">
                    <label class="text-sm text-slate-300">Výsledek:</label>
                    <select id="history-result-filter" onchange="filterSignalHistory()" class="crypto-input text-sm rounded-lg p-2">
                        <option value="all">Všechny výsledky</option>
                        <option value="profit">Pouze zisky</option>
                        <option value="loss">Pouze ztráty</option>
                    </select>
                </div>
                <div class="flex items-center gap-2">
                    <label class="text-sm text-slate-300">Období:</label>
                    <select id="history-period-filter" onchange="filterSignalHistory()" class="crypto-input text-sm rounded-lg p-2">
                        <option value="all">Celá historie</option>
                        <option value="today">Dnes</option>
                        <option value="week">Tento týden</option>
                        <option value="month">Tento měsíc</option>
                    </select>
                </div>
            </div>

            <!-- Signal History Table -->
            <div class="overflow-x-auto">
                <div id="signal-history-container" class="space-y-3">
                    <div class="text-center py-8 text-slate-400">
                        <div class="text-4xl mb-4">📈</div>
                        <div class="text-lg font-medium mb-2">Žádná historická data</div>
                        <div class="text-sm">Historie signálů se zobrazí po uzavření prvního signálu</div>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div id="history-pagination" class="flex items-center justify-between mt-6 pt-4 border-t border-slate-600 hidden">
                <div class="text-sm text-slate-400">
                    Zobrazeno <span id="showing-from">1</span>-<span id="showing-to">10</span> z <span id="total-records">0</span> záznamů
                </div>
                <div class="flex gap-2">
                    <button onclick="previousHistoryPage()" id="prev-page-btn" class="px-3 py-2 bg-slate-700 text-slate-300 rounded-lg text-sm hover:bg-slate-600 transition-colors disabled:opacity-50" disabled>
                        ← Předchozí
                    </button>
                    <button onclick="nextHistoryPage()" id="next-page-btn" class="px-3 py-2 bg-slate-700 text-slate-300 rounded-lg text-sm hover:bg-slate-600 transition-colors disabled:opacity-50" disabled>
                        Další →
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Real-time market data storage
        let currentSymbol = 'SOLUSDT';
        let marketData = {
            price: 0,
            change: 0,
            volume: 0,
            btcDominance: 0,
            fundingRate: 0,
            openInterest: 0,
            longShortRatio: 0,
            btcPrice: 0,
            marketCap: 0
        };

        // Configuration settings
        let config = {
            timeframe: '3m',
            refreshCycle: '1h',
            riskLevel: 'medium',
            soundAlerts: true,
            signalSoundAlerts: true,
            entryType: 'limit',
            volumeMonitor: true,
            volumeThreshold: 200,
            monitorTimeframe: '5m',
            alertSound: 'beep'
        };

        // Volume monitoring data
        let volumeData = {};
        let volumeAlerts = [];
        let refreshInterval;

        // Multi-Signal Management
        const MAX_SIGNALS = 5;
        let activeSignals = [];
        let signalIdCounter = 1;
        let signalUpdateInterval;

        // Signal History Management
        let signalHistory = [];
        let filteredHistory = [];
        let currentHistoryPage = 1;
        const RECORDS_PER_PAGE = 10;

        // Legacy single signal (for backward compatibility)
        let activeSignal = {
            isActive: false,
            openTime: null,
            openPrice: 0,
            direction: 'LONG',
            symbol: '',
            entryPrice: 0,
            stopLoss: 0,
            takeProfit1: 0,
            takeProfit2: 0,
            remainingPosition: 100,
            realizedPnL: 0,
            maxProfit: 0,
            trailingStopActive: false,
            trailingDistance: 1.0,
            highestPrice: 0,
            lowestPrice: 0
        };

        // Signal tracking for alerts
        let lastSignalDirection = null;
        let lastSignalStrength = 0;

        // Technical analysis data
        let technicalData = {
            fibLevels: {},
            srLevels: [],
            rsi: 0,
            macd: { signal: 'NEUTRAL', histogram: 0 },
            bollinger: { position: 'MIDDLE', upper: 0, lower: 0 },
            volumeTrend: 'NEUTRAL',
            priceHistory: []
        };

        // Action history
        let actionHistory = [];

        // Coin mapping for CoinGecko API
        const coinGeckoMapping = {
            'BTCUSDT': 'bitcoin',
            'ETHUSDT': 'ethereum',
            'ADAUSDT': 'cardano',
            'XRPUSDT': 'ripple',
            'SOLUSDT': 'solana',
            'AVAXUSDT': 'avalanche-2',
            'DOGEUSDT': 'dogecoin',
            'LINKUSDT': 'chainlink',
            'DOTUSDT': 'polkadot',
            'HYPEUSDT': 'hyperliquid',
            'APTUSDT': 'aptos',
            'TIAUSDT': 'celestia',
            'OPUSDT': 'optimism',
            'SUIUSDT': 'sui',
            'ARKMUSDT': 'arkham',
            'WLDUSDT': 'worldcoin-wld'
        };

        // Bybit API endpoints
        const BYBIT_BASE = 'https://api.bybit.com';
        const COINGECKO_BASE = 'https://api.coingecko.com/api/v3';

        async function fetchBybitData() {
            try {
                // Get ticker data for current symbol
                const tickerResponse = await fetch(`${BYBIT_BASE}/v5/market/tickers?category=spot&symbol=${currentSymbol}`);
                const tickerData = await tickerResponse.json();
                
                if (tickerData.result && tickerData.result.list.length > 0) {
                    const ticker = tickerData.result.list[0];
                    marketData.price = parseFloat(ticker.lastPrice);
                    marketData.change = parseFloat(ticker.price24hPcnt) * 100;
                    marketData.volume = parseFloat(ticker.volume24h) * marketData.price;
                }

                // Get funding rate for perpetual (try linear category first)
                try {
                    const fundingResponse = await fetch(`${BYBIT_BASE}/v5/market/funding/history?category=linear&symbol=${currentSymbol}&limit=1`);
                    const fundingData = await fundingResponse.json();
                    
                    if (fundingData.result && fundingData.result.list.length > 0) {
                        marketData.fundingRate = parseFloat(fundingData.result.list[0].fundingRate);
                    }
                } catch (fundingError) {
                    // If linear fails, try inverse category for some coins
                    try {
                        const fundingResponse = await fetch(`${BYBIT_BASE}/v5/market/funding/history?category=inverse&symbol=${currentSymbol}&limit=1`);
                        const fundingData = await fundingResponse.json();
                        
                        if (fundingData.result && fundingData.result.list.length > 0) {
                            marketData.fundingRate = parseFloat(fundingData.result.list[0].fundingRate);
                        }
                    } catch (e) {
                        console.log('Funding rate not available for', currentSymbol);
                        marketData.fundingRate = 0;
                    }
                }

                // Get open interest
                try {
                    const oiResponse = await fetch(`${BYBIT_BASE}/v5/market/open-interest?category=linear&symbol=${currentSymbol}`);
                    const oiData = await oiResponse.json();
                    
                    if (oiData.result && oiData.result.list.length > 0) {
                        marketData.openInterest = parseFloat(oiData.result.list[0].openInterest) * marketData.price;
                    }
                } catch (oiError) {
                    console.log('Open interest not available for', currentSymbol);
                    marketData.openInterest = 0;
                }

                // Get long/short ratio
                try {
                    const lsResponse = await fetch(`${BYBIT_BASE}/v5/market/account-ratio?category=linear&symbol=${currentSymbol}&period=5min&limit=1`);
                    const lsData = await lsResponse.json();
                    
                    if (lsData.result && lsData.result.list.length > 0) {
                        const ratio = lsData.result.list[0];
                        marketData.longShortRatio = parseFloat(ratio.buyRatio) / parseFloat(ratio.sellRatio);
                    }
                } catch (lsError) {
                    console.log('Long/Short ratio not available for', currentSymbol);
                    marketData.longShortRatio = 1.0;
                }

            } catch (error) {
                console.error('Chyba při načítání Bybit dat:', error);
                showError('Nepodařilo se načíst data z Bybit API');
            }
        }

        async function fetchCoinGeckoData() {
            try {
                const coinId = coinGeckoMapping[currentSymbol];
                
                if (coinId) {
                    // Get current coin data
                    const coinResponse = await fetch(`${COINGECKO_BASE}/simple/price?ids=${coinId}&vs_currencies=usd&include_market_cap=true&include_24hr_change=true`);
                    const coinData = await coinResponse.json();
                    
                    if (coinData[coinId]) {
                        // Use CoinGecko data as backup/verification
                        if (marketData.price === 0) {
                            marketData.price = coinData[coinId].usd;
                            marketData.change = coinData[coinId].usd_24h_change;
                        }
                        marketData.marketCap = coinData[coinId].usd_market_cap;
                    }
                }

                // Get BTC dominance
                const globalResponse = await fetch(`${COINGECKO_BASE}/global`);
                const globalData = await globalResponse.json();
                
                if (globalData.data) {
                    marketData.btcDominance = globalData.data.market_cap_percentage.btc;
                }

                // Get BTC price for correlation
                const btcResponse = await fetch(`${COINGECKO_BASE}/simple/price?ids=bitcoin&vs_currencies=usd`);
                const btcData = await btcResponse.json();
                
                if (btcData.bitcoin) {
                    marketData.btcPrice = btcData.bitcoin.usd;
                }

            } catch (error) {
                console.error('Chyba při načítání CoinGecko dat:', error);
                showError('Nepodařilo se načíst data z CoinGecko API');
            }
        }

        function updateMarketData() {
            // Update price label and display
            const symbol = currentSymbol.replace('USDT', '');
            document.getElementById('price-label').textContent = `${symbol}/USDT Cena:`;
            document.getElementById('coin-price').textContent = marketData.price > 0 ? `$${marketData.price.toFixed(marketData.price < 1 ? 4 : 2)}` : 'Loading...';
            
            // Update change display
            const changeElement = document.getElementById('coin-change');
            if (marketData.change !== 0) {
                const changeText = marketData.change > 0 ? `+${marketData.change.toFixed(2)}%` : `${marketData.change.toFixed(2)}%`;
                changeElement.textContent = changeText;
                changeElement.className = marketData.change > 0 ? 'font-semibold text-green-600' : 'font-semibold text-red-600';
            }
            
            // Update volume
            document.getElementById('coin-volume').textContent = marketData.volume > 0 ? `$${(marketData.volume / 1000000).toFixed(0)}M` : 'Loading...';
            
            // Update BTC dominance
            document.getElementById('btc-dominance').textContent = marketData.btcDominance > 0 ? `${marketData.btcDominance.toFixed(1)}%` : 'Loading...';
            
            // Update funding rate
            const fundingElement = document.getElementById('funding-rate');
            if (marketData.fundingRate !== 0) {
                fundingElement.textContent = `${(marketData.fundingRate * 100).toFixed(4)}%`;
                fundingElement.className = marketData.fundingRate < 0 ? 'font-semibold text-green-600' : 'font-semibold text-red-600';
            } else {
                fundingElement.textContent = 'N/A';
                fundingElement.className = 'font-semibold text-gray-500';
            }
            
            // Update open interest
            document.getElementById('open-interest').textContent = marketData.openInterest > 0 ? `$${(marketData.openInterest / 1000000).toFixed(0)}M` : 'N/A';
            
            // Update long/short ratio
            document.getElementById('long-short-ratio').textContent = marketData.longShortRatio > 0 ? `${marketData.longShortRatio.toFixed(2)}:1` : 'N/A';
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50';
            errorDiv.innerHTML = `
                <strong>Chyba:</strong> ${message}
                <button onclick="this.parentElement.remove()" class="ml-2 text-red-500 hover:text-red-700">×</button>
            `;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                if (errorDiv.parentElement) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        async function changeCoin() {
            const selector = document.getElementById('coin-selector');
            currentSymbol = selector.value;
            
            // Update current pair display
            const symbol = currentSymbol.replace('USDT', '');
            document.getElementById('current-pair').textContent = `${symbol}/USDT`;
            
            // Reset market data
            marketData = {
                price: 0,
                change: 0,
                volume: 0,
                btcDominance: 0,
                fundingRate: 0,
                openInterest: 0,
                longShortRatio: 0,
                btcPrice: 0,
                marketCap: 0
            };
            
            // Load new data
            await loadAllData();
        }

        async function loadAllData() {
            const loadingElements = document.querySelectorAll('#coin-price, #coin-change, #coin-volume, #btc-dominance, #funding-rate, #open-interest, #long-short-ratio');
            loadingElements.forEach(el => el.textContent = 'Loading...');
            
            try {
                await Promise.all([
                    fetchBybitData(),
                    fetchCoinGeckoData()
                ]);
                updateMarketData();
                updateAnalysis();
                
                // Update active signal if present
                if (activeSignal.isActive) {
                    updateSignalDisplay();
                }
            } catch (error) {
                console.error('Chyba při načítání dat:', error);
                showError('Nepodařilo se načíst tržní data');
            }
        }

        function updateAnalysis() {
            // Update trade direction based on real data
            const directionElement = document.getElementById('trade-direction');
            const direction = marketData.change > 0 && marketData.fundingRate <= 0 ? 'LONG' : 'SHORT';
            directionElement.textContent = direction;
            directionElement.className = direction === 'LONG' ? 'text-2xl font-bold text-green-600 mb-2' : 'text-2xl font-bold text-red-600 mb-2';
            
            // Check for signal changes and alert if enabled
            checkSignalChanges(direction);
            
            // Update entry zones based on current price
            if (marketData.price > 0) {
                const currentPrice = marketData.price;
                const decimals = currentPrice < 1 ? 4 : 2;
                const obLow = currentPrice * 0.995;
                const obHigh = currentPrice * 1.002;
                const lvnLow = currentPrice * 0.998;
                const lvnHigh = currentPrice * 1.001;
                const poc = currentPrice * 0.999;
                const sr = currentPrice * 1.0015;
                
                // Update entry zone displays
                document.getElementById('ob-zone').textContent = `$${obLow.toFixed(decimals)} - $${obHigh.toFixed(decimals)}`;
                document.getElementById('lvn-zone').textContent = `$${lvnLow.toFixed(decimals)} - $${lvnHigh.toFixed(decimals)}`;
                document.getElementById('poc-level').textContent = `$${poc.toFixed(decimals)}`;
                document.getElementById('sr-level').textContent = `$${sr.toFixed(decimals)}`;
                
                // Calculate technical indicators
                calculateTechnicalIndicators();
                updateTechnicalDisplay();
            }
            
            // Update correlation data
            updateCorrelationData();
        }

        function checkSignalChanges(currentDirection) {
            if (!config.signalSoundAlerts || !config.soundAlerts) return;
            
            // Calculate signal strength based on multiple factors
            const rsiStrength = technicalData.rsi > 70 ? 100 : technicalData.rsi < 30 ? 100 : Math.abs(technicalData.rsi - 50) * 2;
            const changeStrength = Math.abs(marketData.change) * 10;
            const volumeStrength = technicalData.volumeTrend === 'INCREASING' ? 80 : technicalData.volumeTrend === 'DECREASING' ? 20 : 50;
            
            const currentStrength = (rsiStrength + changeStrength + volumeStrength) / 3;
            
            // Check for direction change
            if (lastSignalDirection && lastSignalDirection !== currentDirection) {
                playSound('alert');
                addActionToHistory('SIGNAL_DIRECTION_CHANGE', `Signál změnil směr z ${lastSignalDirection} na ${currentDirection}`, 0);
                
                // Show notification if not in active signal mode
                if (!activeSignal.isActive) {
                    showSignalNotification(`🔄 Signál změnil směr na ${currentDirection}`, 'direction-change');
                }
            }
            
            // Check for significant strength change (>20 points)
            if (lastSignalStrength > 0 && Math.abs(currentStrength - lastSignalStrength) > 20) {
                const strengthChange = currentStrength > lastSignalStrength ? 'posílil' : 'oslabil';
                playSound('notification');
                addActionToHistory('SIGNAL_STRENGTH_CHANGE', `Signál se ${strengthChange} (${currentStrength.toFixed(0)}%)`, 0);
                
                if (!activeSignal.isActive) {
                    showSignalNotification(`📊 Síla signálu se ${strengthChange} na ${currentStrength.toFixed(0)}%`, 'strength-change');
                }
            }
            
            // Update tracking variables
            lastSignalDirection = currentDirection;
            lastSignalStrength = currentStrength;
        }

        function showSignalNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 glass-card crypto-glow p-4 z-50 max-w-sm transform transition-all duration-500 translate-x-full`;
            
            const bgColor = type === 'direction-change' ? 'bg-orange-400 bg-opacity-10 border-orange-400' : 'bg-blue-400 bg-opacity-10 border-blue-400';
            notification.className += ` ${bgColor} border-opacity-30`;
            
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="text-2xl">${type === 'direction-change' ? '🔄' : '📊'}</div>
                        <div>
                            <div class="font-semibold text-slate-200">${message}</div>
                            <div class="text-xs text-slate-400">${new Date().toLocaleTimeString('cs-CZ')}</div>
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-slate-400 hover:text-slate-200 text-xl">×</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 500);
            }, 5000);
        }

        function calculateTechnicalIndicators() {
            const currentPrice = marketData.price;
            const change24h = marketData.change;
            const volume = marketData.volume;
            
            // Store price history for calculations
            technicalData.priceHistory.push({
                price: currentPrice,
                volume: volume,
                timestamp: Date.now()
            });
            
            // Keep only last 50 data points
            if (technicalData.priceHistory.length > 50) {
                technicalData.priceHistory = technicalData.priceHistory.slice(-50);
            }
            
            // Calculate Fibonacci levels based on 24h high/low
            const high24h = currentPrice * (1 + Math.abs(change24h) / 100);
            const low24h = currentPrice * (1 - Math.abs(change24h) / 100);
            const range = high24h - low24h;
            
            technicalData.fibLevels = {
                '0%': high24h,
                '23.6%': high24h - (range * 0.236),
                '38.2%': high24h - (range * 0.382),
                '50%': high24h - (range * 0.5),
                '61.8%': high24h - (range * 0.618),
                '100%': low24h
            };
            
            // Calculate Support/Resistance levels
            technicalData.srLevels = [
                { level: currentPrice * 1.05, type: 'resistance', strength: 'strong' },
                { level: currentPrice * 1.02, type: 'resistance', strength: 'medium' },
                { level: currentPrice * 0.98, type: 'support', strength: 'medium' },
                { level: currentPrice * 0.95, type: 'support', strength: 'strong' }
            ];
            
            // Calculate RSI (simplified)
            if (technicalData.priceHistory.length >= 14) {
                const prices = technicalData.priceHistory.slice(-14).map(p => p.price);
                let gains = 0, losses = 0;
                
                for (let i = 1; i < prices.length; i++) {
                    const change = prices[i] - prices[i-1];
                    if (change > 0) gains += change;
                    else losses += Math.abs(change);
                }
                
                const avgGain = gains / 13;
                const avgLoss = losses / 13;
                const rs = avgGain / (avgLoss || 0.001);
                technicalData.rsi = 100 - (100 / (1 + rs));
            } else {
                // Estimate RSI based on 24h change
                technicalData.rsi = 50 + (change24h * 2);
                technicalData.rsi = Math.max(0, Math.min(100, technicalData.rsi));
            }
            
            // Calculate MACD signal (simplified)
            if (change24h > 2) {
                technicalData.macd.signal = 'BULLISH';
                technicalData.macd.histogram = Math.abs(change24h) / 2;
            } else if (change24h < -2) {
                technicalData.macd.signal = 'BEARISH';
                technicalData.macd.histogram = -Math.abs(change24h) / 2;
            } else {
                technicalData.macd.signal = 'NEUTRAL';
                technicalData.macd.histogram = 0;
            }
            
            // Calculate Bollinger Band position
            const volatility = Math.abs(change24h) / 100;
            const upperBB = currentPrice * (1 + volatility * 2);
            const lowerBB = currentPrice * (1 - volatility * 2);
            
            technicalData.bollinger.upper = upperBB;
            technicalData.bollinger.lower = lowerBB;
            
            if (currentPrice > upperBB * 0.95) {
                technicalData.bollinger.position = 'UPPER';
            } else if (currentPrice < lowerBB * 1.05) {
                technicalData.bollinger.position = 'LOWER';
            } else {
                technicalData.bollinger.position = 'MIDDLE';
            }
            
            // Calculate Volume Trend
            if (technicalData.priceHistory.length >= 5) {
                const recentVolumes = technicalData.priceHistory.slice(-5).map(p => p.volume);
                const avgVolume = recentVolumes.reduce((a, b) => a + b, 0) / recentVolumes.length;
                
                if (volume > avgVolume * 1.5) {
                    technicalData.volumeTrend = 'INCREASING';
                } else if (volume < avgVolume * 0.7) {
                    technicalData.volumeTrend = 'DECREASING';
                } else {
                    technicalData.volumeTrend = 'STABLE';
                }
            } else {
                technicalData.volumeTrend = 'STABLE';
            }
        }

        function updateTechnicalDisplay() {
            // Update Fibonacci levels
            const fibContainer = document.getElementById('fib-levels');
            const currentPrice = marketData.price;
            const decimals = currentPrice < 1 ? 4 : 2;
            
            let fibHtml = '';
            Object.entries(technicalData.fibLevels).forEach(([level, price]) => {
                const distance = Math.abs(currentPrice - price);
                const isNear = distance < currentPrice * 0.01;
                const colorClass = isNear ? 'text-orange-600 font-semibold' : 'text-gray-600';
                
                fibHtml += `
                    <div class="flex justify-between items-center text-sm">
                        <span class="${colorClass}">${level}:</span>
                        <span class="${colorClass}">$${price.toFixed(decimals)}</span>
                    </div>
                `;
            });
            fibContainer.innerHTML = fibHtml;
            
            // Update current Fibonacci position
            let fibPosition = 'Between levels';
            Object.entries(technicalData.fibLevels).forEach(([level, price]) => {
                if (Math.abs(currentPrice - price) < currentPrice * 0.005) {
                    fibPosition = `Near ${level}`;
                }
            });
            document.getElementById('fib-position').textContent = fibPosition;
            
            // Update S/R levels
            const srContainer = document.getElementById('sr-levels');
            let srHtml = '';
            technicalData.srLevels.forEach(sr => {
                const distance = Math.abs(currentPrice - sr.level);
                const isNear = distance < currentPrice * 0.01;
                const typeColor = sr.type === 'resistance' ? 'text-red-600' : 'text-green-600';
                const strengthIcon = sr.strength === 'strong' ? '🔴' : '🟡';
                
                srHtml += `
                    <div class="flex justify-between items-center text-sm">
                        <span class="${typeColor}">${strengthIcon} ${sr.type.toUpperCase()}:</span>
                        <span class="${isNear ? 'font-semibold text-purple-600' : 'text-gray-600'}">$${sr.level.toFixed(decimals)}</span>
                    </div>
                `;
            });
            srContainer.innerHTML = srHtml;
            
            // Find nearest S/R level
            const nearest = technicalData.srLevels.reduce((prev, curr) => 
                Math.abs(currentPrice - curr.level) < Math.abs(currentPrice - prev.level) ? curr : prev
            );
            document.getElementById('nearest-sr').textContent = `${nearest.type.toUpperCase()} $${nearest.level.toFixed(decimals)}`;
            
            // Update technical indicators
            const rsiElement = document.getElementById('rsi-value');
            rsiElement.textContent = technicalData.rsi.toFixed(1);
            if (technicalData.rsi > 70) {
                rsiElement.className = 'font-semibold text-red-600';
            } else if (technicalData.rsi < 30) {
                rsiElement.className = 'font-semibold text-green-600';
            } else {
                rsiElement.className = 'font-semibold text-blue-600';
            }
            
            const macdElement = document.getElementById('macd-signal');
            macdElement.textContent = technicalData.macd.signal;
            const macdColors = {
                'BULLISH': 'font-semibold text-green-600',
                'BEARISH': 'font-semibold text-red-600',
                'NEUTRAL': 'font-semibold text-gray-600'
            };
            macdElement.className = macdColors[technicalData.macd.signal];
            
            const bbElement = document.getElementById('bb-position');
            bbElement.textContent = technicalData.bollinger.position;
            const bbColors = {
                'UPPER': 'font-semibold text-red-600',
                'LOWER': 'font-semibold text-green-600',
                'MIDDLE': 'font-semibold text-blue-600'
            };
            bbElement.className = bbColors[technicalData.bollinger.position];
            
            const volumeElement = document.getElementById('volume-trend');
            volumeElement.textContent = technicalData.volumeTrend;
            const volumeColors = {
                'INCREASING': 'font-semibold text-green-600',
                'DECREASING': 'font-semibold text-red-600',
                'STABLE': 'font-semibold text-blue-600'
            };
            volumeElement.className = volumeColors[technicalData.volumeTrend];
        }

        function updateCorrelationData() {
            // Calculate BTC correlation (simplified)
            const btcCorrelation = marketData.change > 0 && marketData.btcPrice > 0 ? 0.73 : -0.23;
            const total3Change = marketData.change * 1.2; // Simplified altcoin strength calculation
            
            // Update correlation displays
            const correlationElements = document.querySelectorAll('.text-2xl.font-bold');
            if (correlationElements.length >= 3) {
                correlationElements[1].textContent = btcCorrelation > 0 ? `+${btcCorrelation.toFixed(2)}` : btcCorrelation.toFixed(2);
                correlationElements[1].className = btcCorrelation > 0 ? 'text-2xl font-bold text-green-600 mb-2' : 'text-2xl font-bold text-red-600 mb-2';
                
                correlationElements[2].textContent = marketData.btcDominance > 0 ? `${marketData.btcDominance.toFixed(1)}%` : '58.2%';
                
                if (correlationElements[3]) {
                    correlationElements[3].textContent = total3Change > 0 ? `+${total3Change.toFixed(1)}%` : `${total3Change.toFixed(1)}%`;
                    correlationElements[3].className = total3Change > 0 ? 'text-2xl font-bold text-purple-600 mb-2' : 'text-2xl font-bold text-red-600 mb-2';
                }
            }
        }

        // Multi-Signal Management Functions
        function addSignal() {
            if (activeSignals.length >= MAX_SIGNALS) {
                alert(`Maximální počet signálů je ${MAX_SIGNALS}. Nejprve ukončete některý aktivní signál.`);
                return;
            }

            if (marketData.price === 0) {
                alert('Čekejte na načtení tržních dat před přidáním signálu.');
                return;
            }

            const currentPrice = marketData.price;
            const symbol = currentSymbol.replace('USDT', '');
            const direction = marketData.change > 0 ? 'LONG' : 'SHORT';
            
            // Create new signal
            const newSignal = {
                id: signalIdCounter++,
                isActive: true,
                status: 'ACTIVE',
                openTime: new Date(),
                openPrice: currentPrice,
                direction: direction,
                symbol: currentSymbol,
                entryPrice: currentPrice,
                stopLoss: currentPrice * (direction === 'LONG' ? 0.985 : 1.015),
                takeProfit1: currentPrice * (direction === 'LONG' ? 1.02 : 0.98),
                takeProfit2: currentPrice * (direction === 'LONG' ? 1.035 : 0.965),
                remainingPosition: 100,
                realizedPnL: 0,
                maxProfit: 0,
                trailingStopActive: false,
                trailingDistance: 1.0,
                highestPrice: currentPrice,
                lowestPrice: currentPrice
            };

            activeSignals.push(newSignal);
            
            // Update displays
            updateSignalsDisplay();
            
            // Start monitoring if not already running
            if (!signalUpdateInterval) {
                startSignalMonitoring();
            }
            
            // Add to action history
            addActionToHistory('SIGNAL_ADDED', `${direction} signál přidán pro ${symbol}/USDT na $${currentPrice.toFixed(4)}`, 0);
            
            // Play confirmation sound
            if (config.soundAlerts) playSound('chime');
            
            alert(`✅ Signál přidán!\n\n${symbol}/USDT ${direction}\nVstup: $${currentPrice.toFixed(4)}\nSL: $${newSignal.stopLoss.toFixed(4)}\nTP1: $${newSignal.takeProfit1.toFixed(4)}\nTP2: $${newSignal.takeProfit2.toFixed(4)}\n\nCelkem aktivních signálů: ${activeSignals.length}/${MAX_SIGNALS}`);
        }

        function closeSignal(signalId) {
            const signalIndex = activeSignals.findIndex(s => s.id === signalId);
            if (signalIndex === -1) {
                alert('Signál nenalezen.');
                return;
            }

            const signal = activeSignals[signalIndex];
            const currentPrice = marketData.price;
            
            // Calculate P&L for this signal's symbol
            let signalPrice = currentPrice;
            if (signal.symbol !== currentSymbol) {
                // For different symbols, use the stored price (simplified)
                signalPrice = signal.openPrice; // This would need real-time price fetching in production
            }
            
            const pnlPercent = signal.direction === 'LONG' 
                ? ((signalPrice - signal.openPrice) / signal.openPrice) * 100
                : ((signal.openPrice - signalPrice) / signal.openPrice) * 100;

            const remainingPnL = (pnlPercent * signal.remainingPosition / 100);
            const totalPnL = signal.realizedPnL + remainingPnL;

            if (confirm(`Opravdu chcete ukončit signál ${signal.symbol.replace('USDT', '')}/USDT?\n\nZbývající pozice: ${signal.remainingPosition}%\nAktuální P&L: ${pnlPercent > 0 ? '+' : ''}${pnlPercent.toFixed(2)}%\nCelkový P&L: ${totalPnL > 0 ? '+' : ''}${totalPnL.toFixed(2)}%`)) {
                
                // Add to signal history before removing
                addSignalToHistory(signal, signalPrice, totalPnL);
                
                // Remove signal from active list
                activeSignals.splice(signalIndex, 1);
                
                // Add to action history
                addActionToHistory('SIGNAL_CLOSED', `${signal.symbol.replace('USDT', '')} signál uzavřen na $${signalPrice.toFixed(4)}`, totalPnL);
                
                // Update display
                updateSignalsDisplay();
                
                // Stop monitoring if no active signals
                if (activeSignals.length === 0 && signalUpdateInterval) {
                    clearInterval(signalUpdateInterval);
                    signalUpdateInterval = null;
                }
                
                // Play confirmation sound
                if (config.soundAlerts) playSound('alert');
                
                alert(`🔴 Signál ${signal.symbol.replace('USDT', '')} ukončen!\n\nFinální P&L: ${totalPnL > 0 ? '+' : ''}${totalPnL.toFixed(2)}%\nTrvání: ${getSignalDuration(signal.openTime)}\n\nZbývající signály: ${activeSignals.length}`);
            }
        }

        function clearAllSignals() {
            if (activeSignals.length === 0) {
                alert('Žádné aktivní signály k vymazání.');
                return;
            }

            if (confirm(`Opravdu chcete vymazat všech ${activeSignals.length} aktivních signálů?`)) {
                // Add all signals to history and calculate total P&L
                let totalPnL = 0;
                const signalCount = activeSignals.length;
                
                activeSignals.forEach(signal => {
                    const currentPrice = marketData.price; // Simplified - would need real prices for each symbol
                    const pnlPercent = signal.direction === 'LONG' 
                        ? ((currentPrice - signal.openPrice) / signal.openPrice) * 100
                        : ((signal.openPrice - currentPrice) / signal.openPrice) * 100;
                    const signalTotalPnL = signal.realizedPnL + (pnlPercent * signal.remainingPosition / 100);
                    totalPnL += signalTotalPnL;
                    
                    // Add each signal to history
                    addSignalToHistory(signal, currentPrice, signalTotalPnL);
                });

                // Clear all signals
                activeSignals = [];
                
                // Stop monitoring
                if (signalUpdateInterval) {
                    clearInterval(signalUpdateInterval);
                    signalUpdateInterval = null;
                }
                
                // Update display
                updateSignalsDisplay();
                
                // Add to action history
                addActionToHistory('ALL_SIGNALS_CLEARED', `Všech ${signalCount} signálů vymazáno`, totalPnL);
                
                // Play confirmation sound
                if (config.soundAlerts) {
                    playSound('alert');
                    setTimeout(() => playSound('alert'), 300);
                }
                
                alert(`🗑️ Všechny signály vymazány!\n\nCelkový P&L: ${totalPnL > 0 ? '+' : ''}${totalPnL.toFixed(2)}%\nPočet signálů: ${signalCount}`);
            }
        }

        function updateSignalsDisplay() {
            const container = document.getElementById('signals-container');
            
            // Update active signals counter
            document.getElementById('active-signals-count').textContent = `${activeSignals.length} / ${MAX_SIGNALS}`;
            
            if (activeSignals.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = activeSignals.map(signal => {
                const symbol = signal.symbol.replace('USDT', '');
                const duration = getSignalDuration(signal.openTime);
                
                // Calculate current P&L (simplified for display)
                const currentPrice = signal.symbol === currentSymbol ? marketData.price : signal.openPrice;
                const pnlPercent = signal.direction === 'LONG' 
                    ? ((currentPrice - signal.openPrice) / signal.openPrice) * 100
                    : ((signal.openPrice - currentPrice) / signal.openPrice) * 100;
                
                const remainingPnL = (pnlPercent * signal.remainingPosition / 100);
                const totalPnL = signal.realizedPnL + remainingPnL;
                
                const statusColor = signal.direction === 'LONG' ? 'text-green-600' : 'text-red-600';
                const pnlColor = totalPnL >= 0 ? 'text-green-600' : 'text-red-600';
                const bgColor = signal.direction === 'LONG' ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
                
                return `
                    <div class="bg-white rounded-xl p-6 card-shadow border-l-4 ${signal.direction === 'LONG' ? 'border-green-500' : 'border-red-500'}">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">${signal.direction === 'LONG' ? '📈' : '📉'}</div>
                                <div>
                                    <h3 class="text-lg font-semibold ${statusColor}">${symbol}/USDT ${signal.direction}</h3>
                                    <div class="text-sm text-gray-600">
                                        ID: #${signal.id} • Trvání: ${duration} • Status: ${signal.status}
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="text-right">
                                    <div class="text-2xl font-bold ${pnlColor}">${totalPnL >= 0 ? '+' : ''}${totalPnL.toFixed(2)}%</div>
                                    <div class="text-sm text-gray-600">P&L</div>
                                </div>
                                <button onclick="closeSignal(${signal.id})" class="text-red-600 hover:text-red-800 text-xl font-bold px-2 py-1 rounded hover:bg-red-50 transition-colors" title="Uzavřít signál">
                                    ✕
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                            <div class="text-center p-3 ${bgColor} rounded-lg">
                                <div class="text-sm text-gray-600">Entry</div>
                                <div class="font-semibold">$${signal.entryPrice.toFixed(4)}</div>
                            </div>
                            <div class="text-center p-3 bg-red-50 border border-red-200 rounded-lg">
                                <div class="text-sm text-gray-600">Stop Loss</div>
                                <div class="font-semibold text-red-600">$${signal.stopLoss.toFixed(4)}</div>
                            </div>
                            <div class="text-center p-3 bg-green-50 border border-green-200 rounded-lg">
                                <div class="text-sm text-gray-600">TP1</div>
                                <div class="font-semibold text-green-600">$${signal.takeProfit1.toFixed(4)}</div>
                            </div>
                            <div class="text-center p-3 bg-green-50 border border-green-200 rounded-lg">
                                <div class="text-sm text-gray-600">TP2</div>
                                <div class="font-semibold text-green-600">$${signal.takeProfit2.toFixed(4)}</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Partial Close Controls -->
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-800 mb-3">📊 Partial Close</h4>
                                <div class="grid grid-cols-3 gap-2 mb-3">
                                    <button onclick="partialClose(${signal.id}, 25)" class="px-3 py-2 bg-blue-600 text-slate-100 text-sm rounded-lg hover:bg-blue-700 transition-colors">
                                        25%
                                    </button>
                                    <button onclick="partialClose(${signal.id}, 50)" class="px-3 py-2 bg-blue-600 text-slate-100 text-sm rounded-lg hover:bg-blue-700 transition-colors">
                                        50%
                                    </button>
                                    <button onclick="partialClose(${signal.id}, 75)" class="px-3 py-2 bg-blue-600 text-slate-100 text-sm rounded-lg hover:bg-blue-700 transition-colors">
                                        75%
                                    </button>
                                </div>
                                <div class="text-xs text-blue-700">
                                    <div>Zbývající: <span class="font-semibold">${signal.remainingPosition}%</span></div>
                                    <div>Realizováno: <span class="font-semibold">${signal.realizedPnL >= 0 ? '+' : ''}${signal.realizedPnL.toFixed(2)}%</span></div>
                                </div>
                            </div>

                            <!-- Trailing Stop Controls -->
                            <div class="bg-purple-50 rounded-lg p-4">
                                <h4 class="font-semibold text-purple-800 mb-3">🎯 Trailing Stop</h4>
                                <div class="space-y-2 mb-3">
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm text-purple-700">Status:</label>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" ${signal.trailingStopActive ? 'checked' : ''} onchange="toggleTrailingStop(${signal.id})" class="sr-only peer">
                                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-purple-600"></div>
                                        </label>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button onclick="setTrailingDistance(${signal.id}, 0.5)" class="px-2 py-1 text-xs rounded border border-purple-300 hover:bg-purple-100 transition-colors ${signal.trailingDistance === 0.5 ? 'bg-purple-100 text-purple-700' : ''}">0.5%</button>
                                        <button onclick="setTrailingDistance(${signal.id}, 1.0)" class="px-2 py-1 text-xs rounded border border-purple-300 hover:bg-purple-100 transition-colors ${signal.trailingDistance === 1.0 ? 'bg-purple-100 text-purple-700' : ''}">1.0%</button>
                                        <button onclick="setTrailingDistance(${signal.id}, 1.5)" class="px-2 py-1 text-xs rounded border border-purple-300 hover:bg-purple-100 transition-colors ${signal.trailingDistance === 1.5 ? 'bg-purple-100 text-purple-700' : ''}">1.5%</button>
                                        <button onclick="setTrailingDistance(${signal.id}, 2.0)" class="px-2 py-1 text-xs rounded border border-purple-300 hover:bg-purple-100 transition-colors ${signal.trailingDistance === 2.0 ? 'bg-purple-100 text-purple-700' : ''}">2.0%</button>
                                    </div>
                                </div>
                                <div class="text-xs text-purple-700">
                                    <div>Max Profit: <span class="font-semibold">${signal.maxProfit >= 0 ? '+' : ''}${signal.maxProfit.toFixed(2)}%</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function refreshData() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '🔄 Načítám...';
            button.disabled = true;
            
            try {
                await loadAllData();
                button.innerHTML = '✅ Aktualizováno';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 2000);
            } catch (error) {
                button.innerHTML = '❌ Chyba';
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 2000);
            }
        }

        function openSignal() {
            if (activeSignal.isActive) {
                alert('Signál je již aktivní! Nejprve ukončete současný signál.');
                return;
            }

            if (marketData.price === 0) {
                alert('Čekejte na načtení tržních dat před otevřením signálu.');
                return;
            }

            const currentPrice = marketData.price;
            const symbol = currentSymbol.replace('USDT', '');
            const direction = marketData.change > 0 && marketData.fundingRate <= 0 ? 'LONG' : 'SHORT';
            
            if (confirm(`Opravdu chcete otevřít signál ${symbol}/USDT?\n\nSměr: ${direction}\nEntry Type: ${config.entryType.toUpperCase()}\nCena: $${currentPrice.toFixed(4)}\n\nPo aktivaci budou probíhat pouze kontrolní analýzy.`)) {
                
                // Set signal data
                activeSignal = {
                    isActive: true,
                    openTime: new Date(),
                    openPrice: currentPrice,
                    direction: direction,
                    symbol: currentSymbol,
                    entryPrice: currentPrice,
                    stopLoss: currentPrice * (direction === 'LONG' ? 0.985 : 1.015),
                    takeProfit1: currentPrice * (direction === 'LONG' ? 1.02 : 0.98),
                    takeProfit2: currentPrice * (direction === 'LONG' ? 1.035 : 0.965),
                    remainingPosition: 100,
                    realizedPnL: 0,
                    maxProfit: 0,
                    trailingStopActive: false,
                    trailingDistance: 1.0,
                    highestPrice: currentPrice,
                    lowestPrice: currentPrice
                };

                // Update UI - switch to monitoring mode
                document.getElementById('open-signal-btn').classList.add('hidden');
                document.getElementById('close-signal-btn').classList.remove('hidden');
                document.getElementById('signal-status').classList.remove('hidden');
                document.getElementById('action-history').classList.remove('hidden');
                
                // Update status display
                const statusElement = document.querySelector('#current-trend span:last-child');
                if (statusElement) {
                    statusElement.innerHTML = '<span class="text-orange-400">(Aktivní Monitoring)</span>';
                }
                
                // Update signal display
                updateSignalDisplay();
                
                // Start signal monitoring
                startSignalMonitoring();
                
                // Add to action history
                addActionToHistory('SIGNAL_OPENED', `${direction} signál aktivován (${config.entryType}) na $${currentPrice.toFixed(4)}`, 0);
                
                // Play confirmation sound
                if (config.soundAlerts) playSound('chime');
                
                // Show success notification
                showSignalNotification(`🎯 ${symbol} ${direction} signál aktivován - Monitoring spuštěn`, 'signal-opened');
                
                alert(`✅ Signál ${symbol}/USDT aktivován!\n\n📊 Režim: Kontrolní Analýzy\n🎯 Směr: ${direction}\n💰 Entry: $${currentPrice.toFixed(4)} (${config.entryType})\n🛡️ SL: $${activeSignal.stopLoss.toFixed(4)}\n🎯 TP1: $${activeSignal.takeProfit1.toFixed(4)}\n🏆 TP2: $${activeSignal.takeProfit2.toFixed(4)}\n\n⚡ Kontinuální monitoring aktivní...`);
            }
        }

        function closeSignal() {
            if (!activeSignal.isActive) {
                alert('Žádný aktivní signál k ukončení.');
                return;
            }

            const currentPrice = marketData.price;
            const symbol = activeSignal.symbol.replace('USDT', '');
            const pnlPercent = activeSignal.direction === 'LONG' 
                ? ((currentPrice - activeSignal.openPrice) / activeSignal.openPrice) * 100
                : ((activeSignal.openPrice - currentPrice) / activeSignal.openPrice) * 100;

            const remainingPnL = (pnlPercent * activeSignal.remainingPosition / 100);
            const totalPnL = activeSignal.realizedPnL + remainingPnL;
            const duration = getSignalDuration(activeSignal.openTime);

            if (confirm(`Opravdu chcete ukončit aktivní signál ${symbol}?\n\n📊 Monitoring Mode: UKONČIT\n💰 Zbývající pozice: ${activeSignal.remainingPosition}%\n📈 Aktuální P&L: ${pnlPercent > 0 ? '+' : ''}${pnlPercent.toFixed(2)}%\n🏆 Celkový P&L: ${totalPnL > 0 ? '+' : ''}${totalPnL.toFixed(2)}%\n⏱️ Trvání: ${duration}`)) {
                
                // Stop signal monitoring
                if (signalUpdateInterval) {
                    clearInterval(signalUpdateInterval);
                    signalUpdateInterval = null;
                }

                // Add to signal history (convert legacy signal format)
                const legacySignalForHistory = {
                    id: Date.now(), // Generate ID for legacy signal
                    symbol: activeSignal.symbol,
                    direction: activeSignal.direction,
                    openTime: activeSignal.openTime,
                    openPrice: activeSignal.openPrice,
                    stopLoss: activeSignal.stopLoss,
                    takeProfit1: activeSignal.takeProfit1,
                    takeProfit2: activeSignal.takeProfit2,
                    realizedPnL: activeSignal.realizedPnL,
                    maxProfit: activeSignal.maxProfit,
                    remainingPosition: activeSignal.remainingPosition,
                    trailingStopActive: activeSignal.trailingStopActive
                };
                addSignalToHistory(legacySignalForHistory, currentPrice, totalPnL);

                // Add final close to history
                addActionToHistory('SIGNAL_CLOSED', `${symbol} signál ukončen na $${currentPrice.toFixed(4)}`, totalPnL);

                // Reset signal
                activeSignal.isActive = false;
                
                // Update UI - return to analysis mode
                document.getElementById('open-signal-btn').classList.remove('hidden');
                document.getElementById('close-signal-btn').classList.add('hidden');
                document.getElementById('signal-status').classList.add('hidden');
                
                // Reset status display
                const statusElement = document.querySelector('#current-trend span:last-child');
                if (statusElement) {
                    statusElement.innerHTML = '<span class="text-slate-500">(Síla: 78%)</span>';
                }
                
                // Play confirmation sound
                if (config.soundAlerts) {
                    playSound('alert');
                    setTimeout(() => playSound('notification'), 300);
                }
                
                // Show close notification
                showSignalNotification(`🔴 ${symbol} signál ukončen - Návrat k analýzám`, 'signal-closed');
                
                alert(`🔴 Signál ${symbol}/USDT ukončen!\n\n📊 Režim: Návrat k Analýzám\n🏆 Finální P&L: ${totalPnL > 0 ? '+' : ''}${totalPnL.toFixed(2)}%\n💰 Realizovaný P&L: ${activeSignal.realizedPnL > 0 ? '+' : ''}${activeSignal.realizedPnL.toFixed(2)}%\n⏱️ Trvání: ${duration}\n📈 Max Profit: ${activeSignal.maxProfit > 0 ? '+' : ''}${activeSignal.maxProfit.toFixed(2)}%\n\n✅ Monitoring ukončen - Pokračování v analýzách...`);
            }
        }

        // Multi-signal partial close function
        function partialClose(signalId, percentage) {
            const signal = activeSignals.find(s => s.id === signalId);
            if (!signal) {
                alert('Signál nenalezen.');
                return;
            }

            if (signal.remainingPosition < percentage) {
                alert(`Nelze uzavřít ${percentage}% - zbývá pouze ${signal.remainingPosition}% pozice.`);
                return;
            }

            const currentPrice = signal.symbol === currentSymbol ? marketData.price : signal.openPrice;
            const pnlPercent = signal.direction === 'LONG' 
                ? ((currentPrice - signal.openPrice) / signal.openPrice) * 100
                : ((signal.openPrice - currentPrice) / signal.openPrice) * 100;

            const partialPnL = (pnlPercent * percentage / 100);
            
            if (confirm(`Uzavřít ${percentage}% pozice ${signal.symbol.replace('USDT', '')}/USDT?\n\nAktuální cena: $${currentPrice.toFixed(4)}\nP&L za tuto část: ${partialPnL > 0 ? '+' : ''}${partialPnL.toFixed(2)}%`)) {
                // Update position
                signal.remainingPosition -= percentage;
                signal.realizedPnL += partialPnL;
                
                // Update display
                updateSignalsDisplay();
                
                // Add to history
                addActionToHistory('PARTIAL_CLOSE', `${signal.symbol.replace('USDT', '')} ${percentage}% uzavřeno na $${currentPrice.toFixed(4)}`, partialPnL);
                
                // Play sound
                if (config.soundAlerts) playSound('notification');
                
                // Check if position is fully closed
                if (signal.remainingPosition <= 0) {
                    setTimeout(() => {
                        alert(`Pozice ${signal.symbol.replace('USDT', '')} byla plně uzavřena prostřednictvím partial close operací.`);
                        closeSignal(signalId);
                    }, 1000);
                }
            }
        }

        // Multi-signal trailing stop functions
        function toggleTrailingStop(signalId) {
            const signal = activeSignals.find(s => s.id === signalId);
            if (!signal) return;
            
            signal.trailingStopActive = !signal.trailingStopActive;
            
            if (signal.trailingStopActive) {
                const currentPrice = signal.symbol === currentSymbol ? marketData.price : signal.openPrice;
                signal.highestPrice = Math.max(signal.highestPrice, currentPrice);
                signal.lowestPrice = Math.min(signal.lowestPrice, currentPrice);
                
                addActionToHistory('TRAILING_ACTIVATED', `${signal.symbol.replace('USDT', '')} trailing stop aktivován (${signal.trailingDistance}%)`, 0);
                if (config.soundAlerts) playSound('beep');
            } else {
                addActionToHistory('TRAILING_DEACTIVATED', `${signal.symbol.replace('USDT', '')} trailing stop deaktivován`, 0);
            }
            
            updateSignalsDisplay();
        }

        function setTrailingDistance(signalId, distance) {
            const signal = activeSignals.find(s => s.id === signalId);
            if (!signal) return;
            
            signal.trailingDistance = distance;
            
            if (signal.trailingStopActive) {
                updateTrailingStop(signal);
                addActionToHistory('TRAILING_UPDATED', `${signal.symbol.replace('USDT', '')} trailing distance změněna na ${distance}%`, 0);
            }
            
            updateSignalsDisplay();
            if (config.soundAlerts) playSound('beep');
        }

        function updateTrailingStop(signal) {
            if (!signal.trailingStopActive) return;
            
            const currentPrice = signal.symbol === currentSymbol ? marketData.price : signal.openPrice;
            const trailingPercent = signal.trailingDistance / 100;
            
            if (signal.direction === 'LONG') {
                // Update highest price
                if (currentPrice > signal.highestPrice) {
                    signal.highestPrice = currentPrice;
                }
                
                // Calculate new trailing stop
                const newStopLoss = signal.highestPrice * (1 - trailingPercent);
                
                // Only update if new stop loss is higher than current
                if (newStopLoss > signal.stopLoss) {
                    const oldSL = signal.stopLoss;
                    signal.stopLoss = newStopLoss;
                    
                    addActionToHistory('TRAILING_UPDATED', `${signal.symbol.replace('USDT', '')} SL přesunut z $${oldSL.toFixed(4)} na $${newStopLoss.toFixed(4)}`, 0);
                    
                    if (config.soundAlerts) playSound('notification');
                }
            } else {
                // SHORT position
                if (currentPrice < signal.lowestPrice) {
                    signal.lowestPrice = currentPrice;
                }
                
                const newStopLoss = signal.lowestPrice * (1 + trailingPercent);
                
                if (newStopLoss < signal.stopLoss) {
                    const oldSL = signal.stopLoss;
                    signal.stopLoss = newStopLoss;
                    
                    addActionToHistory('TRAILING_UPDATED', `${signal.symbol.replace('USDT', '')} SL přesunut z $${oldSL.toFixed(4)} na $${newStopLoss.toFixed(4)}`, 0);
                    
                    if (config.soundAlerts) playSound('notification');
                }
            }
        }

        // Action history functions
        function addActionToHistory(type, description, pnl) {
            const action = {
                type: type,
                description: description,
                pnl: pnl,
                timestamp: new Date(),
                price: marketData.price
            };
            
            actionHistory.unshift(action);
            
            // Keep only last 20 actions
            if (actionHistory.length > 20) {
                actionHistory = actionHistory.slice(0, 20);
            }
            
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyContainer = document.getElementById('history-list');
            
            if (actionHistory.length === 0) {
                historyContainer.innerHTML = '<div class="text-sm text-gray-500 text-center py-4">Žádné akce zatím...</div>';
                return;
            }
            
            const typeColors = {
                'SIGNAL_ADDED': 'bg-green-50 border-green-200 text-green-800',
                'SIGNAL_CLOSED': 'bg-red-50 border-red-200 text-red-800',
                'ALL_SIGNALS_CLEARED': 'bg-red-50 border-red-200 text-red-800',
                'PARTIAL_CLOSE': 'bg-blue-50 border-blue-200 text-blue-800',
                'TRAILING_ACTIVATED': 'bg-purple-50 border-purple-200 text-purple-800',
                'TRAILING_DEACTIVATED': 'bg-gray-50 border-gray-200 text-gray-800',
                'TRAILING_UPDATED': 'bg-yellow-50 border-yellow-200 text-yellow-800',
                'TP1_HIT': 'bg-green-50 border-green-200 text-green-800',
                'TP2_HIT': 'bg-green-50 border-green-200 text-green-800',
                'BREAKEVEN_HIT': 'bg-indigo-50 border-indigo-200 text-indigo-800'
            };
            
            const typeIcons = {
                'SIGNAL_ADDED': '➕',
                'SIGNAL_CLOSED': '✕',
                'ALL_SIGNALS_CLEARED': '🗑️',
                'PARTIAL_CLOSE': '📊',
                'TRAILING_ACTIVATED': '🎯',
                'TRAILING_DEACTIVATED': '⏹️',
                'TRAILING_UPDATED': '📈',
                'TP1_HIT': '🎯',
                'TP2_HIT': '🏆',
                'BREAKEVEN_HIT': '⚖️'
            };
            
            historyContainer.innerHTML = actionHistory.map(action => {
                const timeStr = action.timestamp.toLocaleTimeString('cs-CZ');
                const colorClass = typeColors[action.type] || 'bg-gray-50 border-gray-200 text-gray-800';
                const icon = typeIcons[action.type] || '📋';
                const pnlStr = action.pnl !== 0 ? ` (${action.pnl > 0 ? '+' : ''}${action.pnl.toFixed(2)}%)` : '';
                
                return `
                    <div class="flex items-center justify-between p-3 border rounded-lg ${colorClass}">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">${icon}</span>
                            <div>
                                <div class="text-sm font-medium">${action.description}${pnlStr}</div>
                                <div class="text-xs opacity-75">${timeStr} • $${action.price.toFixed(4)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function startSignalMonitoring() {
            // Update all signals every 30 seconds
            signalUpdateInterval = setInterval(() => {
                updateAllSignals();
                checkAllSignalConditions();
            }, 30000);
        }

        function updateAllSignals() {
            if (activeSignals.length === 0) return;

            activeSignals.forEach(signal => {
                // Update max profit tracking
                const currentPrice = signal.symbol === currentSymbol ? marketData.price : signal.openPrice;
                const currentPnlPercent = signal.direction === 'LONG' 
                    ? ((currentPrice - signal.openPrice) / signal.openPrice) * 100
                    : ((signal.openPrice - currentPrice) / signal.openPrice) * 100;

                const remainingPnL = (currentPnlPercent * signal.remainingPosition / 100);
                const totalPnL = signal.realizedPnL + remainingPnL;

                if (totalPnL > signal.maxProfit) {
                    signal.maxProfit = totalPnL;
                }
                
                // Update trailing stop if active
                if (signal.trailingStopActive) {
                    updateTrailingStop(signal);
                }
            });
            
            // Update display
            updateSignalsDisplay();
        }

        function checkAllSignalConditions() {
            if (activeSignals.length === 0) return;
            
            activeSignals.forEach(signal => {
                const currentPrice = signal.symbol === currentSymbol ? marketData.price : signal.openPrice;
                
                // Auto-close on stop loss
                if ((signal.direction === 'LONG' && currentPrice <= signal.stopLoss) ||
                    (signal.direction === 'SHORT' && currentPrice >= signal.stopLoss)) {
                    
                    if (config.soundAlerts) {
                        playSound('alert');
                        setTimeout(() => playSound('alert'), 500);
                        setTimeout(() => playSound('alert'), 1000);
                    }
                    
                    alert(`⚠️ STOP LOSS HIT!\n\n${signal.symbol.replace('USDT', '')} signál bude automaticky ukončen.`);
                    closeSignal(signal.id);
                    return;
                }
                
                // Alert on take profit levels
                if (signal.direction === 'LONG') {
                    if (currentPrice >= signal.takeProfit2) {
                        if (config.soundAlerts) playSound('chime');
                        addActionToHistory('TP2_HIT', `${signal.symbol.replace('USDT', '')} TP2 dosažen na $${currentPrice.toFixed(4)}`, 0);
                    } else if (currentPrice >= signal.takeProfit1) {
                        if (config.soundAlerts) playSound('notification');
                        addActionToHistory('TP1_HIT', `${signal.symbol.replace('USDT', '')} TP1 dosažen na $${currentPrice.toFixed(4)}`, 0);
                    }
                } else {
                    if (currentPrice <= signal.takeProfit2) {
                        if (config.soundAlerts) playSound('chime');
                        addActionToHistory('TP2_HIT', `${signal.symbol.replace('USDT', '')} TP2 dosažen na $${currentPrice.toFixed(4)}`, 0);
                    } else if (currentPrice <= signal.takeProfit1) {
                        if (config.soundAlerts) playSound('notification');
                        addActionToHistory('TP1_HIT', `${signal.symbol.replace('USDT', '')} TP1 dosažen na $${currentPrice.toFixed(4)}`, 0);
                    }
                }
            });
        }

        function getSignalDuration(openTime) {
            if (!openTime) return '0m';
            
            const now = new Date();
            const diffMs = now - openTime;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffDays > 0) {
                return `${diffDays}d ${diffHours % 24}h`;
            } else if (diffHours > 0) {
                return `${diffHours}h ${diffMins % 60}m`;
            } else {
                return `${diffMins}m`;
            }
        }

        function exportPlan() {
            const planData = {
                pair: 'SOL/USDT',
                direction: 'LONG',
                entry: '$143.15',
                stopLoss: '$141.80',
                takeProfit1: '$144.80',
                takeProfit2: '$146.20',
                rrr: '2.3:1',
                checklistScore: '12/14',
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(planData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'scalper2-trading-plan.json';
            link.click();
        }

        // Configuration functions
        function updateTimeframe() {
            config.timeframe = document.getElementById('timeframe-selector').value;
            console.log('Timeframe updated to:', config.timeframe);
            if (config.soundAlerts) playSound('beep');
        }

        function updateRefreshCycle() {
            config.refreshCycle = document.getElementById('refresh-cycle').value;
            
            // Clear existing interval
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            // Set new interval based on refresh cycle
            const intervals = {
                '1m': 60000,
                '3m': 180000,
                '5m': 300000,
                '15m': 900000,
                '30m': 1800000,
                '1h': 3600000,
                '4h': 14400000,
                '12h': 43200000,
                '1D': 86400000
            };
            
            refreshInterval = setInterval(() => {
                loadAllData();
                if (config.volumeMonitor) {
                    checkVolumeSpikes();
                }
            }, intervals[config.refreshCycle]);
            
            console.log('Refresh cycle updated to:', config.refreshCycle);
            if (config.soundAlerts) playSound('beep');
        }

        function setRiskLevel(level) {
            config.riskLevel = level;
            
            // Update button styles
            document.querySelectorAll('[id^="risk-"]').forEach(btn => {
                btn.className = btn.className.replace(/bg-\w+-50/, '').replace(/text-\w+-700/, '');
            });
            
            const colors = {
                'low': 'bg-green-50 text-green-700',
                'medium': 'bg-yellow-50 text-yellow-700',
                'high': 'bg-red-50 text-red-700'
            };
            
            document.getElementById(`risk-${level}`).className += ` ${colors[level]}`;
            
            console.log('Risk level set to:', level);
            if (config.soundAlerts) playSound('beep');
        }

        function toggleSoundAlerts() {
            config.soundAlerts = document.getElementById('sound-alerts').checked;
            console.log('Sound alerts:', config.soundAlerts ? 'enabled' : 'disabled');
        }

        function toggleSignalSoundAlerts() {
            config.signalSoundAlerts = document.getElementById('signal-sound-alerts').checked;
            console.log('Signal sound alerts:', config.signalSoundAlerts ? 'enabled' : 'disabled');
            if (config.soundAlerts && config.signalSoundAlerts) playSound('beep');
        }

        function setEntryType(type) {
            config.entryType = type;
            
            // Update button styles
            document.querySelectorAll('[id^="entry-"]').forEach(btn => {
                btn.className = btn.className.replace(/bg-cyan-400 bg-opacity-20/, '').replace(/text-cyan-400/, 'text-slate-300');
                btn.className = btn.className.replace(/border-cyan-400 border-opacity-30/, 'border-cyan-400 border-opacity-30');
            });
            
            const selectedBtn = document.getElementById(`entry-${type}`);
            selectedBtn.className = selectedBtn.className.replace(/text-slate-300/, 'text-cyan-400');
            selectedBtn.className = selectedBtn.className.replace(/border-opacity-30/, '');
            selectedBtn.className += ' bg-cyan-400 bg-opacity-20';
            
            // Update display
            const entryTypes = {
                'limit': 'Limit Order',
                'market': 'Market Order', 
                'conditional': 'Conditional Order'
            };
            document.getElementById('entry-type').textContent = entryTypes[type];
            
            console.log('Entry type set to:', type);
            if (config.soundAlerts) playSound('beep');
        }

        function toggleVolumeMonitor() {
            config.volumeMonitor = document.getElementById('volume-monitor').checked;
            
            if (config.volumeMonitor) {
                startVolumeMonitoring();
                console.log('Volume monitoring enabled');
            } else {
                console.log('Volume monitoring disabled');
            }
            
            if (config.soundAlerts) playSound('beep');
        }

        function setVolumeThreshold(threshold) {
            config.volumeThreshold = threshold;
            
            // Update button styles
            document.querySelectorAll('[id^="vol-"]').forEach(btn => {
                btn.className = btn.className.replace(/bg-blue-50/, '').replace(/text-blue-700/, '');
            });
            
            document.getElementById(`vol-${threshold}`).className += ' bg-blue-50 text-blue-700';
            
            console.log('Volume threshold set to:', threshold + '%');
            if (config.soundAlerts) playSound('beep');
        }

        function updateMonitorTimeframe() {
            config.monitorTimeframe = document.getElementById('monitor-timeframe').value;
            console.log('Monitor timeframe updated to:', config.monitorTimeframe);
            if (config.soundAlerts) playSound('beep');
        }

        function setAlertSound(sound) {
            config.alertSound = sound;
            
            // Update button styles
            document.querySelectorAll('[id^="sound-"]').forEach(btn => {
                btn.className = btn.className.replace(/bg-blue-50/, '').replace(/text-blue-700/, '');
            });
            
            document.getElementById(`sound-${sound}`).className += ' bg-blue-50 text-blue-700';
            
            // Play test sound
            playSound(sound);
            console.log('Alert sound set to:', sound);
        }

        // Sound functions
        function playSound(type) {
            if (!config.soundAlerts) return;
            
            // Create audio context for different sound types
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            const sounds = {
                'beep': { frequency: 800, duration: 200 },
                'chime': { frequency: 1000, duration: 300 },
                'alert': { frequency: 600, duration: 500 },
                'notification': { frequency: 1200, duration: 150 }
            };
            
            const sound = sounds[type] || sounds.beep;
            
            oscillator.frequency.setValueAtTime(sound.frequency, audioContext.currentTime);
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + sound.duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + sound.duration / 1000);
        }

        // Volume monitoring functions
        async function startVolumeMonitoring() {
            if (!config.volumeMonitor) return;
            
            const coins = ['BTCUSDT', 'ETHUSDT', 'ADAUSDT', 'XRPUSDT', 'SOLUSDT', 'AVAXUSDT', 
                          'DOGEUSDT', 'LINKUSDT', 'DOTUSDT', 'HYPEUSDT', 'APTUSDT', 'TIAUSDT', 
                          'OPUSDT', 'SUIUSDT', 'ARKMUSDT', 'WLDUSDT'];
            
            for (const coin of coins) {
                try {
                    const response = await fetch(`${BYBIT_BASE}/v5/market/tickers?category=spot&symbol=${coin}`);
                    const data = await response.json();
                    
                    if (data.result && data.result.list.length > 0) {
                        const ticker = data.result.list[0];
                        const currentVolume = parseFloat(ticker.volume24h);
                        
                        if (volumeData[coin]) {
                            const previousVolume = volumeData[coin].volume;
                            const volumeChange = ((currentVolume - previousVolume) / previousVolume) * 100;
                            
                            if (volumeChange >= config.volumeThreshold) {
                                addVolumeAlert(coin, volumeChange, parseFloat(ticker.lastPrice));
                            }
                        }
                        
                        volumeData[coin] = {
                            volume: currentVolume,
                            price: parseFloat(ticker.lastPrice),
                            change: parseFloat(ticker.price24hPcnt) * 100,
                            timestamp: Date.now()
                        };
                    }
                } catch (error) {
                    console.error(`Error monitoring ${coin}:`, error);
                }
            }
        }

        function addVolumeAlert(coin, volumeChange, price) {
            const alert = {
                coin: coin,
                volumeChange: volumeChange,
                price: price,
                timestamp: Date.now(),
                id: Date.now() + Math.random()
            };
            
            volumeAlerts.unshift(alert);
            
            // Keep only last 10 alerts
            if (volumeAlerts.length > 10) {
                volumeAlerts = volumeAlerts.slice(0, 10);
            }
            
            updateVolumeAlertsDisplay();
            
            // Play alert sound
            if (config.soundAlerts) {
                playSound(config.alertSound);
            }
            
            console.log(`Volume spike detected: ${coin} +${volumeChange.toFixed(1)}%`);
        }

        function updateVolumeAlertsDisplay() {
            const alertsContainer = document.getElementById('volume-alerts');
            
            if (volumeAlerts.length === 0) {
                alertsContainer.innerHTML = '<div class="text-sm text-gray-500 text-center py-4">Žádné volume spiky zatím...</div>';
                return;
            }
            
            alertsContainer.innerHTML = volumeAlerts.map(alert => {
                const timeAgo = Math.floor((Date.now() - alert.timestamp) / 60000);
                const symbol = alert.coin.replace('USDT', '');
                
                return `
                    <div class="flex items-center justify-between p-3 bg-orange-50 border border-orange-200 rounded-lg">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="font-semibold text-orange-800">${symbol}/USDT</span>
                                <span class="text-sm text-orange-600">+${alert.volumeChange.toFixed(1)}%</span>
                            </div>
                            <div class="text-xs text-orange-600">
                                $${alert.price.toFixed(alert.price < 1 ? 4 : 2)} • ${timeAgo}m ago
                            </div>
                        </div>
                        <button onclick="showCoinAnalysis('${alert.coin}')" class="px-3 py-1 bg-orange-600 text-slate-100 text-xs rounded-lg hover:bg-orange-700 transition-colors">
                            SHOW
                        </button>
                    </div>
                `;
            }).join('');
        }

        function showCoinAnalysis(coin) {
            // Switch to the coin and perform analysis
            document.getElementById('coin-selector').value = coin;
            changeCoin();
            
            // Scroll to market data
            document.querySelector('.gradient-bg').scrollIntoView({ behavior: 'smooth' });
            
            if (config.soundAlerts) playSound('chime');
        }

        async function checkVolumeSpikes() {
            if (config.volumeMonitor) {
                await startVolumeMonitoring();
            }
        }

        // Signal History Functions
        function addSignalToHistory(signal, finalPrice, finalPnL) {
            const historyEntry = {
                id: signal.id,
                symbol: signal.symbol,
                direction: signal.direction,
                openTime: signal.openTime,
                closeTime: new Date(),
                openPrice: signal.openPrice,
                closePrice: finalPrice,
                stopLoss: signal.stopLoss,
                takeProfit1: signal.takeProfit1,
                takeProfit2: signal.takeProfit2,
                finalPnL: finalPnL,
                realizedPnL: signal.realizedPnL,
                maxProfit: signal.maxProfit,
                duration: getSignalDuration(signal.openTime),
                trailingUsed: signal.trailingStopActive,
                partialCloses: 100 - signal.remainingPosition,
                entryType: config.entryType,
                riskLevel: config.riskLevel
            };
            
            signalHistory.unshift(historyEntry);
            
            // Keep only last 100 signals
            if (signalHistory.length > 100) {
                signalHistory = signalHistory.slice(0, 100);
            }
            
            // Save to localStorage
            localStorage.setItem('cryptoScalperHistory', JSON.stringify(signalHistory));
            
            // Update displays
            updateHistoryStats();
            filterSignalHistory();
        }

        function loadSignalHistory() {
            const saved = localStorage.getItem('cryptoScalperHistory');
            if (saved) {
                try {
                    signalHistory = JSON.parse(saved);
                    // Convert date strings back to Date objects
                    signalHistory.forEach(entry => {
                        entry.openTime = new Date(entry.openTime);
                        entry.closeTime = new Date(entry.closeTime);
                    });
                    updateHistoryStats();
                    filterSignalHistory();
                } catch (error) {
                    console.error('Error loading signal history:', error);
                    signalHistory = [];
                }
            }
        }

        function updateHistoryStats() {
            const totalSignals = signalHistory.length;
            const winningSignals = signalHistory.filter(s => s.finalPnL > 0).length;
            const winRate = totalSignals > 0 ? (winningSignals / totalSignals) * 100 : 0;
            const totalPnL = signalHistory.reduce((sum, s) => sum + s.finalPnL, 0);
            const avgPnL = totalSignals > 0 ? totalPnL / totalSignals : 0;
            
            // Update display elements
            document.getElementById('total-signals').textContent = totalSignals;
            document.getElementById('win-rate').textContent = `${winRate.toFixed(1)}%`;
            
            const totalPnLElement = document.getElementById('total-pnl');
            totalPnLElement.textContent = `${totalPnL >= 0 ? '+' : ''}${totalPnL.toFixed(2)}%`;
            totalPnLElement.className = `text-2xl font-bold mb-1 ${totalPnL >= 0 ? 'text-green-400' : 'text-red-400'}`;
            
            const avgPnLElement = document.getElementById('avg-pnl');
            avgPnLElement.textContent = `${avgPnL >= 0 ? '+' : ''}${avgPnL.toFixed(2)}%`;
            avgPnLElement.className = `text-2xl font-bold mb-1 ${avgPnL >= 0 ? 'text-green-400' : 'text-red-400'}`;
        }

        function filterSignalHistory() {
            const pairFilter = document.getElementById('history-pair-filter').value;
            const directionFilter = document.getElementById('history-direction-filter').value;
            const resultFilter = document.getElementById('history-result-filter').value;
            const periodFilter = document.getElementById('history-period-filter').value;
            
            filteredHistory = signalHistory.filter(signal => {
                // Pair filter
                if (pairFilter !== 'all' && signal.symbol !== pairFilter) return false;
                
                // Direction filter
                if (directionFilter !== 'all' && signal.direction !== directionFilter) return false;
                
                // Result filter
                if (resultFilter === 'profit' && signal.finalPnL <= 0) return false;
                if (resultFilter === 'loss' && signal.finalPnL >= 0) return false;
                
                // Period filter
                if (periodFilter !== 'all') {
                    const now = new Date();
                    const signalDate = new Date(signal.closeTime);
                    
                    switch (periodFilter) {
                        case 'today':
                            if (signalDate.toDateString() !== now.toDateString()) return false;
                            break;
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            if (signalDate < weekAgo) return false;
                            break;
                        case 'month':
                            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                            if (signalDate < monthAgo) return false;
                            break;
                    }
                }
                
                return true;
            });
            
            currentHistoryPage = 1;
            displaySignalHistory();
        }

        function displaySignalHistory() {
            const container = document.getElementById('signal-history-container');
            const pagination = document.getElementById('history-pagination');
            
            if (filteredHistory.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-slate-400">
                        <div class="text-4xl mb-4">📈</div>
                        <div class="text-lg font-medium mb-2">Žádná data pro vybrané filtry</div>
                        <div class="text-sm">Zkuste změnit filtry nebo přidat nové signály</div>
                    </div>
                `;
                pagination.classList.add('hidden');
                return;
            }
            
            // Calculate pagination
            const totalRecords = filteredHistory.length;
            const totalPages = Math.ceil(totalRecords / RECORDS_PER_PAGE);
            const startIndex = (currentHistoryPage - 1) * RECORDS_PER_PAGE;
            const endIndex = Math.min(startIndex + RECORDS_PER_PAGE, totalRecords);
            const pageData = filteredHistory.slice(startIndex, endIndex);
            
            // Generate table HTML
            container.innerHTML = pageData.map(signal => {
                const symbol = signal.symbol.replace('USDT', '');
                const pnlColor = signal.finalPnL >= 0 ? 'text-green-400' : 'text-red-400';
                const directionColor = signal.direction === 'LONG' ? 'text-green-400' : 'text-red-400';
                const directionIcon = signal.direction === 'LONG' ? '📈' : '📉';
                
                const openTime = signal.openTime.toLocaleString('cs-CZ');
                const closeTime = signal.closeTime.toLocaleString('cs-CZ');
                
                return `
                    <div class="glass-card p-4 border border-slate-600 hover:border-cyan-400 transition-colors">
                        <div class="grid grid-cols-1 lg:grid-cols-6 gap-4 items-center">
                            <!-- Signal Info -->
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">${directionIcon}</div>
                                <div>
                                    <div class="font-semibold text-slate-200">${symbol}/USDT</div>
                                    <div class="text-sm ${directionColor}">${signal.direction}</div>
                                    <div class="text-xs text-slate-400">ID: #${signal.id}</div>
                                </div>
                            </div>
                            
                            <!-- Prices -->
                            <div class="text-center">
                                <div class="text-sm text-slate-400">Entry / Exit</div>
                                <div class="font-semibold text-slate-200">$${signal.openPrice.toFixed(4)}</div>
                                <div class="font-semibold text-slate-200">$${signal.closePrice.toFixed(4)}</div>
                            </div>
                            
                            <!-- P&L -->
                            <div class="text-center">
                                <div class="text-sm text-slate-400">P&L</div>
                                <div class="text-xl font-bold ${pnlColor}">
                                    ${signal.finalPnL >= 0 ? '+' : ''}${signal.finalPnL.toFixed(2)}%
                                </div>
                                <div class="text-xs text-slate-400">
                                    Max: ${signal.maxProfit >= 0 ? '+' : ''}${signal.maxProfit.toFixed(2)}%
                                </div>
                            </div>
                            
                            <!-- Duration -->
                            <div class="text-center">
                                <div class="text-sm text-slate-400">Trvání</div>
                                <div class="font-semibold text-slate-200">${signal.duration}</div>
                                <div class="text-xs text-slate-400">
                                    ${signal.partialCloses > 0 ? `${signal.partialCloses}% partial` : 'Full close'}
                                </div>
                            </div>
                            
                            <!-- Features -->
                            <div class="text-center">
                                <div class="text-sm text-slate-400">Funkce</div>
                                <div class="flex flex-wrap gap-1 justify-center">
                                    ${signal.trailingUsed ? '<span class="px-2 py-1 bg-purple-600 bg-opacity-20 text-purple-400 text-xs rounded">Trailing</span>' : ''}
                                    ${signal.partialCloses > 0 ? '<span class="px-2 py-1 bg-blue-600 bg-opacity-20 text-blue-400 text-xs rounded">Partial</span>' : ''}
                                    <span class="px-2 py-1 bg-cyan-600 bg-opacity-20 text-cyan-400 text-xs rounded">${signal.entryType}</span>
                                </div>
                            </div>
                            
                            <!-- Times -->
                            <div class="text-center">
                                <div class="text-sm text-slate-400">Časy</div>
                                <div class="text-xs text-slate-300">
                                    <div>Open: ${openTime}</div>
                                    <div>Close: ${closeTime}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Update pagination
            document.getElementById('showing-from').textContent = startIndex + 1;
            document.getElementById('showing-to').textContent = endIndex;
            document.getElementById('total-records').textContent = totalRecords;
            
            document.getElementById('prev-page-btn').disabled = currentHistoryPage <= 1;
            document.getElementById('next-page-btn').disabled = currentHistoryPage >= totalPages;
            
            pagination.classList.remove('hidden');
        }

        function previousHistoryPage() {
            if (currentHistoryPage > 1) {
                currentHistoryPage--;
                displaySignalHistory();
            }
        }

        function nextHistoryPage() {
            const totalPages = Math.ceil(filteredHistory.length / RECORDS_PER_PAGE);
            if (currentHistoryPage < totalPages) {
                currentHistoryPage++;
                displaySignalHistory();
            }
        }

        function clearSignalHistory() {
            if (signalHistory.length === 0) {
                alert('Historie je již prázdná.');
                return;
            }
            
            if (confirm(`Opravdu chcete vymazat celou historii signálů?\n\nTato akce vymaže ${signalHistory.length} záznamů a nelze ji vrátit zpět.`)) {
                signalHistory = [];
                filteredHistory = [];
                localStorage.removeItem('cryptoScalperHistory');
                
                updateHistoryStats();
                displaySignalHistory();
                
                if (config.soundAlerts) playSound('alert');
                alert('✅ Historie signálů byla vymazána.');
            }
        }

        function exportSignalHistory() {
            if (filteredHistory.length === 0) {
                alert('Žádná data k exportu. Zkuste změnit filtry.');
                return;
            }
            
            // Create CSV content
            const headers = [
                'ID', 'Symbol', 'Direction', 'Open Time', 'Close Time', 'Duration',
                'Open Price', 'Close Price', 'Final P&L (%)', 'Max Profit (%)', 
                'Realized P&L (%)', 'Partial Closes (%)', 'Entry Type', 'Risk Level',
                'Trailing Used', 'Stop Loss', 'Take Profit 1', 'Take Profit 2'
            ];
            
            const csvContent = [
                headers.join(','),
                ...filteredHistory.map(signal => [
                    signal.id,
                    signal.symbol,
                    signal.direction,
                    signal.openTime.toISOString(),
                    signal.closeTime.toISOString(),
                    signal.duration,
                    signal.openPrice,
                    signal.closePrice,
                    signal.finalPnL.toFixed(4),
                    signal.maxProfit.toFixed(4),
                    signal.realizedPnL.toFixed(4),
                    signal.partialCloses,
                    signal.entryType,
                    signal.riskLevel,
                    signal.trailingUsed ? 'Yes' : 'No',
                    signal.stopLoss,
                    signal.takeProfit1,
                    signal.takeProfit2
                ].join(','))
            ].join('\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `crypto-scalper-history-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            if (config.soundAlerts) playSound('chime');
            alert(`✅ Historie exportována!\n\nSoubor obsahuje ${filteredHistory.length} záznamů.`);
        }

        // Initialize data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            updateRefreshCycle(); // Set up initial refresh interval
            loadSignalHistory(); // Load saved signal history
            
            if (config.volumeMonitor) {
                startVolumeMonitoring();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9734164d7315d935',t:'MTc1NTg4MzcxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
